<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>maq.dockerlabs1</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>maq.dockerlabs1</h1><br/><p></p><p><strong><span style="color:#ff0000;">MÁQUINA DOCKERLABS</span></strong></p><p></p><p><img src="images/134-1.png" alt="images/134-1.png" /></p><p></p><p><strong>Para utilizar esta máquina devemos primeiro baixar os arquivos e assim implantá-la com Docker.</strong><strong></strong></p><p><strong>  </strong><strong></strong></p><p><strong>Baixamos o arquivo da página </strong><strong><a href="https://dockerlabs.es/">https://dockerlabs.es/</a></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong>Para implantar o laboratório executamos da seguinte forma, para que também possamos ver que ele nos diz a direção que teremos, bem como o que fazer quando terminarmos.</strong></p><p></p><p><img src="images/134-2.png" alt="images/134-2.png" /></p><p></p><p><strong><span style="color:#ff0000;">COLETA DE INFORMAÇÕES </span></strong></p><p></p><p><span style="color:#ff7800;">nmap 172.17.0.2 -A -sS -sV -sC  --open -p- -T5 -n -Pn          </span>                      </p><p>                                                        </p><p><img src="images/134-3.png" alt="images/134-3.png" />                                                        </p><p><strong>Verificando podemos ver que temos a porta  80 aberta. </strong></p><p></p><p><img src="images/134-4.png" alt="images/134-4.png" /></p><p></p><p><img src="images/134-5.png" alt="images/134-5.png" /></p><p></p><p><strong><span style="color:#ff7800;">UPLOADS</span></strong><strong>: É uma pasta onde são armazenados os arquivos que possivelmente podem ser carregados por alguma rota.</strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><strong><span style="color:#ff7800;">UPLOAD.PHP</span></strong><strong>: É um arquivo php que não pode ser lido, possivelmente é o script intermediário responsável por enviar os arquivos para uploads</strong><strong></strong></p><p><strong>      </strong><strong></strong></p><p><strong></strong><strong><span style="color:#ff7800;">MACHINE.PHP</span></strong><strong>:  O mais interessante dos 3, consiste em um formulário no qual você pode  fazer upload de arquivos que serão armazenados no diretório uploads.</strong><strong></strong></p><p><strong></strong></p><p><img src="images/134-6.png" alt="images/134-6.png" /></p><p></p><p><img src="images/134-7.png" alt="images/134-7.png" /></p><p></p><p><strong>Este é o conteúdo do </strong><strong><span style="color:#ff7800;">machine.php </span></strong><strong>qual nos pede para inserir um arquivo para fazer upload. </strong><strong></strong></p><p><strong>Tentamos fazer upload de um arquivo </strong><strong><span style="color:#ff7800;">txt</span></strong><strong> e ele nos informará o erro que so permite</strong><strong><code> </code></strong><strong><span style="color:#ff7800;">arquivos zip</span></strong><strong></strong></p><p><strong>Como evidentemente estamos diante de um possível </strong><strong><span style="color:#ff7800;">Vulnerabilidade de upload de arquivo arbitrário</span></strong><strong> .</strong><strong></strong></p><p><strong>Abrimos </strong><strong><span style="color:#ff7800;">burp suite</span></strong><strong> para simplificar a tarefa, carregamos um arquivo. Capturamos a solicitação e enviamos para </strong><strong><span style="color:#ff7800;">reapeter</span></strong><strong>. Lá modificaremos as extensões até encontrarmos uma diferente </strong><strong><span style="color:#ff7800;">zip </span></strong><strong>que possa ser interpretada pelo servidor e ao mesmo tempo pular as validações.</strong><strong></strong></p><p><strong> Pois </strong><strong><span style="color:#ff7800;">PHP </span></strong><strong>temos o seguinte </strong><strong><span style="color:#ff7800;">extensiones bypass</span></strong><strong> </strong><strong><code>extensiones bypass</code></strong><strong> ncontrado no </strong><strong><span style="color:#ff7800;">hacktricks</span></strong><strong> </strong><strong><sup><a href="https://rubelperez-github-io.translate.goog/blog/2024/dockerlabs-es-maquina-dockerlabs?_x_tr_sl=auto&_x_tr_tl=en&_x_tr_hl=en#fn:1">1</a></sup></strong><strong></strong></p><p><strong></strong><strong><span style="color:#ff7800;">PHP</span></strong><strong>:  .php, .php2, .php3, .php4, .php5, .php6, .php7, .phps, .phps, .pht,  .phtm, .phtml, .pgif, .shtml, .htaccess, .phar, .inc, .hphp, .ctp,  .módulo</strong><strong></strong></p><p><strong>  Encontramos a extensão correta </strong><strong><span style="color:#ff7800;">phar</span></strong><strong> e criamos uma </strong><strong><span style="color:#ff7800;">reverse shell</span></strong><strong> e enviamos </strong><strong><span style="color:#ff7800;">burp suite</span></strong><strong> com as seguintes características:</strong></p><p></p><p><img src="images/134-8.png" alt="images/134-8.png" /></p><p><img src="images/134-9.png" alt="images/134-9.png" /></p><p></p><p><strong>veja que o arquivo</strong><strong><span style="color:#ff7800;"> “shell.phar” </span></strong><strong>foi enviado com sucesso. </strong><strong></strong></p><p><strong>agora é so clicar nele, e acrescentar na </strong><strong><span style="color:#ff7800;">URL</span></strong><strong>  os comando </strong><strong><span style="color:#ff7800;">?cmd=whoami</span></strong>.</p><p><strong>ficando assim:</strong> <strong><span style="color:#ff7800;">172.17.0.2/uploads/shell.phar?cmd=whoami</span></strong></p><p><strong>veja que agora somos </strong><strong><span style="color:#ff7800;">www-data</span></strong><span style="color:#ff7800;"></span></p><p><span style="color:#ff7800;"></span></p><p><img src="images/134-10.png" alt="images/134-10.png" /></p><p></p><p><strong>agora vamos enviar uma </strong><strong><span style="color:#ff7800;">reverse shell</span></strong><strong> na </strong><strong><span style="color:#ff7800;">URL </span></strong><strong>para nos conectar pelo </strong><strong><span style="color:#ff7800;">NETCAT</span></strong><strong>.</strong><strong></strong></p><p><strong>vamos pegar a 	 no site</strong>: <a href="https://www.revshells.com/">https://www.revshells.com/</a></p><p></p><p><img src="images/134-11.png" alt="images/134-11.png" /></p><p></p><p><strong>agora vamos no </strong><strong><span style="color:#ff7800;">BURP SUITE</span></strong><strong> e colamos a </strong><strong><span style="color:#ff7800;">reverse shell </span></strong><strong>que nem esta mostrando a imagem abaixo:</strong></p><p></p><p><img src="images/134-12.png" alt="images/134-12.png" /></p><p></p><p><img src="images/134-13.png" alt="images/134-13.png" /></p><p></p><p><strong>Abrimos um</strong><strong><span style="color:#ff7800;"> shell</span></strong><strong> em modo de escuta com </strong><strong><span style="color:#ff7800;">nc</span></strong></p><p></p><p><img src="images/134-14.png" alt="images/134-14.png" /></p><p></p><p><strong>Procurando maneiras de escalar privilégios executar o comando </strong><strong><span style="color:#ff7800;">sudo -l</span></strong></p><p></p><p><img src="images/134-15.png" alt="images/134-15.png" /></p><p></p><p><strong>Vemos que temos acesso </strong><strong><span style="color:#ff7800;">sudo</span></strong><strong> a binários que podem ler arquivos com extensão </strong><strong><span style="color:#ff7800;">root</span></strong><strong>. </strong><strong></strong></p><p><strong>Vamos aos percursos mais comuns onde pode haver alguma informação e </strong><strong><span style="color:#ff7800;">opt</span></strong><strong> encontramos algo interessante:</strong></p><p></p><p><img src="images/134-16.png" alt="images/134-16.png" /></p><p></p><p><img src="images/134-17.png" alt="images/134-17.png" /></p><p></p><p><strong>consulta acima pelo </strong><strong><span style="color:#ff7800;">CHATGPT</span></strong><strong>.  ou se preferir no site abaixo</strong>:</p><p></p><p><strong>Vamos para </strong><strong><a href="https://gtfobins.github.io/">https://gtfobins.github.io/</a></strong><strong> e ver como explorar esses binários.</strong><strong></strong></p><p><strong></strong></p><p><img src="images/134-18.png" alt="images/134-18.png" /></p><p></p><p><img src="images/134-19.png" alt="images/134-19.png" /></p><p></p><p><strong>os dois comando tanto do </strong><strong><span style="color:#ff7800;">cut</span></strong><strong> e a do </strong><strong><span style="color:#ff7800;">grep</span></strong><strong> fucionou</strong>:</p><p></p><p><img src="images/134-20.png" alt="images/134-20.png" /></p><p></p><p><strong>Tentamos fazer login como</strong><strong><span style="color:#ff7800;"> root </span></strong><strong>e </strong><strong><span style="color:#ff7800;">senha </span></strong><strong>encontramos</strong>.</p><p></p><p><img src="images/134-21.png" alt="images/134-21.png" /></p><p></p><p><strong><span style="color:#ff0000;">somos root </span></strong></p><p></p><p><span style="color:#ff0000;text-decoration:line-through;">bobmarley</span></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p></div>
</body>
</html>
