<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>maq.buscalove</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>maq.buscalove</h1><br/><p></p><p><img src="images/118-1.png" alt="images/118-1.png" /></p><p></p><p><strong><h1>DockerLabs BuscaLove</h1></strong></p><p></p><p>Para utilizar esta máquina devemos primeiro baixar os arquivos e assim implantá-la com Docker.</p><p>  </p><p>Baixamos o arquivo da página <a href="https://dockerlabs.es/">https://dockerlabs.es/</a></p><p></p><p>Para implantar o laboratório executamos da seguinte forma, para que também possamos ver que ele nos diz a direção que teremos, bem como o que fazer quando terminarmos.</p><p></p><p><img src="images/118-2.png" alt="images/118-2.png" /></p><p></p><p><strong><span style="color:#ff0000;">COLETA DE INFORMAÇÕES </span></strong></p><p></p><p><span style="color:#ff7800;">nmap 172.17.0.2 -sS -sV -sC  --open -p- -T5 -n -Pn          </span>                      </p><p>                                                        </p><p>Verificando as portas podemos ver que temos duas postas abertas  a 22 e a 80. </p><p></p><p><img src="images/118-3.png" alt="images/118-3.png" /></p><p></p><p>Podemos ver que a porta <em><strong>22</strong></em> e a porta <em><strong>80</strong></em> estão abertas , correspondendo ao serviço <em><strong>SSH</strong></em> e <em><strong>HTTP</strong></em> .</p><p>Vamos  obter os subdiretórios existentes na página web para podermos  visualizar outras páginas que nos possam fornecer mais informações. Como  a revisão do código-fonte da página e o uso do comando <em><strong>ffuf</strong></em> para realizar o fuzzing não detectaram novas páginas, usaremos um comando semelhante chamado <em><strong>gobuster</strong></em> , com o qual obteremos as páginas existentes em diferentes formatos. Nesse caso, vamos procurar aqueles que possuem extensão . <em>HTML</em> , . <em>php</em> , . <em>sh</em>, .txt  e . <em>py</em> .</p><p></p><p><strong><span style="color:#ff7800;">gobuster dir -u</span></strong> <a href="http://172.18.0.2">http://172.18.0.2</a> <strong><span style="color:#ff7800;">-w /usr/share/wordlists/dirb/common.txt -x txt,php,html,py,.css</span></strong></p><p></p><p><img src="images/118-4.png" alt="images/118-4.png" /></p><p></p><p>Vemos que existe um subdiretório web chamado <em>wordpress</em> , então vamos visualizar seu conteúdo na web.</p><p></p><p><img src="images/118-5.png" alt="images/118-5.png" /></p><p></p><p><img src="images/118-6.png" alt="images/118-6.png" /></p><p></p><p>Este site possui uma vulnerabilidade do tipo <strong>LFI</strong> ( <em>Local File Inclusion</em>  ), que consiste em o usuário poder acessar e visualizar o conteúdo dos  arquivos locais no servidor a partir do site, portanto, se usarmos <strong>Path Traversal</strong> para escrever No mecanismo de busca por trás do caminho temos a string de texto &quot; <em><strong>?love=../../../../../../etc/passwd</strong></em>  &quot;, podemos visualizar o conteúdo do arquivo passwd, que é usado no  Linux para armazenar as principais informações de cada conta (nome de  usuário, grupo, ID de usuário, ID de grupo, etc.).</p><p>Isto é o que nos é mostrado no arquivo localizado em /etc/passwd:</p><p></p><p><strong><span style="color:#ff7800;">wfuzz -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -u</span></strong> &quot;<a href="http://172.18.0.2/wordpress/index.php?FUZZ=../../../../../etc/passwd">http://172.18.0.2/wordpress/index.php?FUZZ=../../../../../etc/passwd</a>&quot; <strong><span style="color:#ff7800;">--hc 404 --hl 40</span></strong></p><p></p><p><img src="images/118-7.png" alt="images/118-7.png" /></p><p></p><p><img src="images/118-8.png" alt="images/118-8.png" /></p><p></p><p><img src="images/118-9.png" alt="images/118-9.png" /></p><p></p><p>vamos usar o hydra para quebrar a senha ssh</p><p></p><p><strong><span style="color:#ff7800;">hydra -l rosa -P /usr/share/wordlists/rockyou.txt ssh://172.18.0.2:22 -t 64</span></strong></p><p></p><p><img src="images/118-10.png" alt="images/118-10.png" /></p><p></p><p><strong><span style="color:#c061cb;">usuário</span></strong>: <strong><span style="color:#ff7800;">rosa</span></strong></p><p><strong><span style="color:#c061cb;">senha</span></strong>: <strong><span style="color:#ff7800;">lovebug</span></strong> </p><p></p><p><strong><span style="color:#ff7800;">ssh rosa@172.18.0.2</span></strong></p><p></p><p><img src="images/118-11.png" alt="images/118-11.png" /></p><p></p><p><strong><span style="color:#ff0000;">ESCALADA DE PRIVILÉGIOS</span></strong></p><p></p><p><img src="images/118-12.png" alt="images/118-12.png" /></p><p></p><p>O usuário <code>rosa</code> tem permissões sudo para executar os comandos <code>/usr/bin/ls</code> e <code>/usr/bin/cat</code> sem a necessidade de fornecer uma senha (<code>NOPASSWD</code>), o que pode ser explorado para ganhar mais informações ou possivelmente escalonar privilégios.</p><p></p><p><img src="images/118-13.png" alt="images/118-13.png" /></p><p></p><p>Este formato de dados sugere que pode ser uma <strong>string hexadecimal</strong> que pode ser convertida em texto legivel. </p><p><a href="https://gchq.github.io/CyberChef/">https://gchq.github.io/CyberChef/</a> .</p><p></p><p><img src="images/118-14.png" alt="images/118-14.png" /></p><p></p><p><strong><span style="color:#ff0000;">RESULTADO</span></strong>: </p><p>possível senha:  <strong><span style="color:#ff7800;">noacertarasosi</span></strong></p><p></p><p><img src="images/118-15.png" alt="images/118-15.png" /></p><p></p><p>conseguimos entra no usuário pedro usando a senha <strong><span style="color:#ff7800;">noacertarasosi</span></strong> .</p><p></p><p><img src="images/118-16.png" alt="images/118-16.png" /></p><p></p><p>escalação de privilégios sudo -l</p><p></p><p><img src="images/118-17.png" alt="images/118-17.png" /></p><p></p><p>com esse comando <strong><span style="color:#ff7800;">sudo /usr/bin/env bash</span></strong></p><p></p><p><img src="images/118-18.png" alt="images/118-18.png" /></p><p></p><p>uma outra opção é fazer uma pesquisa no site para ter privilégio root com env.</p><p><a href="https://gtfobins.github.io/gtfobins/env/#sudo">https://gtfobins.github.io/gtfobins/env/#sudo</a>.</p><p></p><p><img src="images/118-19.png" alt="images/118-19.png" /></p><p></p><p><img src="images/118-20.png" alt="images/118-20.png" /></p><p></p><p>Executamos o comando e podemos verificar que concluímos esta máquina com sucesso, pois obtivemos acesso <strong><span style="color:#ff7800;">root</span></strong>.</p><p></p><p><strong><span style="color:#ff0000;text-decoration:line-through;">bobmarley</span></strong></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p></div>
</body>
</html>
