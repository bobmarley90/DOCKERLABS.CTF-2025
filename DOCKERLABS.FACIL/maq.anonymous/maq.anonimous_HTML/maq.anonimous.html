<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>maq.anonimous</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>maq.anonimous</h1><br/><p></p><p><img src="images/120-1.png" alt="images/120-1.png" /></p><p></p><p><strong>Para utilizar esta máquina devemos primeiro baixar os arquivos e assim implantá-la com Docker</strong>.</p><p>  </p><p><strong>Baixamos o arquivo da página</strong> <a href="https://dockerlabs.es/">https://dockerlabs.es/</a></p><p></p><p><strong>Para implantar o laboratório executamos da seguinte forma, para que também possamos ver que ele nos diz a direção que teremos, bem como o que fazer quando terminarmos.</strong></p><p></p><p><img src="images/120-2.png" alt="images/120-2.png" /></p><p></p><p><strong><span style="color:#ff0000;">COLETA DE INFORMAÇÕES </span></strong></p><p></p><p><strong><span style="color:#ff7800;">nmap 172.17.0.2 -A  -sS -sV -sC  --open -p- -T5 -n -Pn </span></strong><strong></strong></p><p><strong></strong></p><p><img src="images/120-3.png" alt="images/120-3.png" /></p><p></p><p><strong>Vemos muitas informações do serviço FTP, onde o usuário </strong><strong><span style="color:#ff7800;">anônimo</span></strong><strong> está habilitado . Observamos que todas as informações que nos são reportadas no serviço </strong><strong><span style="color:#ff7800;">ftp</span></strong><strong> são os arquivos fonte do </strong><strong><span style="color:#ff7800;">site</span></strong><strong> que roda na porta 80. Além disso, verificamos se o diretório </strong><strong><span style="color:#ff7800;">/upload</span></strong><strong> dentro do site possui capacidade </strong><strong><span style="color:#ff7800;">de lista de diretórios </span></strong><strong>, portanto será fácil a intrusão. Podemos fazer upload de um </strong><strong><span style="color:#ff7800;">shell reverso</span></strong><strong> e acessá-lo na web para obter acesso. Nós o carregamos no diretório /</strong><strong><span style="color:#ff7800;">upload</span></strong><strong> , que é o único lugar onde temos permissões de gravação.</strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong>vamos entrar no usuário Anonymous do ftp.</strong></p><p></p><p><strong><span style="color:#ff7800;">ftp anonymous@172.17.0.2  </span></strong></p><p></p><p><img src="images/120-4.png" alt="images/120-4.png" /></p><p></p><p><strong>agora crie o shel.php com nano, para enviar para maquina vitma .</strong></p><p></p><p><img src="images/120-5.png" alt="images/120-5.png" /></p><p></p><p><strong>com o comando </strong><strong><span style="color:#ff7800;">put shel.php </span></strong><strong>o arquivo foi baixado na maquina vitima, na pasta upload conforme a imagem abaixo.</strong></p><p></p><p><img src="images/120-6.png" alt="images/120-6.png" /></p><p></p><p><img src="images/120-7.png" alt="images/120-7.png" /></p><p></p><p><strong>vamos entra no navegador com</strong> <a href="http://172.17.0.2/upload/shel.php">http://172.17.0.2/upload/shel.php</a></p><p></p><p><strong>aparentemente parece que nao fucionou, mas fucionou sim .</strong></p><p> </p><p><img src="images/120-8.png" alt="images/120-8.png" /></p><p></p><p><a href="http://172.17.0.2/upload/shel.php?cmd=whoami">http://172.17.0.2/upload/shel.php?cmd=whoami</a></p><p></p><p><img src="images/120-9.png" alt="images/120-9.png" /></p><p></p><p><strong>agora vamos vamos uma reverse shell com bash, para nos termos acesso a maquina da </strong><strong><span style="color:#ff7800;">vitima</span></strong><strong>,</strong><strong></strong></p><p><strong>no terminal da maquina </strong><strong><span style="color:#ff7800;">atacante</span></strong><strong>, com </strong><strong><span style="color:#ff7800;">netcat</span></strong><strong>. </strong></p><p></p><p><strong>vamos pegar a reverse shell no site:</strong> <a href="https://www.revshells.com/">https://www.revshells.com/</a></p><p></p><p><img src="images/120-10.png" alt="images/120-10.png" /></p><p></p><p><strong>vamos usar o Burp Suite .</strong></p><p></p><p><img src="images/120-11.png" alt="images/120-11.png" /></p><p></p><p><strong>na foto acima na parte de  ( ENCODE AS= selecione Url ), copia e cole onde a seta esta marcando ok.</strong></p><p></p><p>++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</p><p></p><p> <img src="images/120-12.png" alt="images/120-12.png" /></p><p></p><p><strong><span style="color:#ff0000;">ESCALAÇAO DE PRIVILÉGIOS</span></strong></p><p></p><p><img src="images/120-13.png" alt="images/120-13.png" /></p><p></p><p>vamos pegar o reverse man no site <a href="https://gtfobins-github-io">https://gtfobins-github-io</a></p><p></p><p><img src="images/120-14.png" alt="images/120-14.png" /></p><p></p><p><img src="images/120-15.png" alt="images/120-15.png" /></p><p></p><p><img src="images/120-16.png" alt="images/120-16.png" /></p><p></p><p><img src="images/120-17.png" alt="images/120-17.png" /></p><p></p><p><strong><span style="color:#000000;">vamos repetir o comando </span></strong><strong><span style="color:#ff7800;">sudo -l</span></strong></p><p></p><p><img src="images/120-18.png" alt="images/120-18.png" /></p><p></p><p><img src="images/120-19.png" alt="images/120-19.png" /></p><p></p><p><strong><span style="color:#ff7800;">sudo -u gladys /usr/bin/dpkg -l</span></strong></p><p></p><p><img src="images/120-20.png" alt="images/120-20.png" /></p><p></p><p><img src="images/120-21.png" alt="images/120-21.png" /></p><p></p><p><strong><span style="color:#ff7800;">sudo -l</span></strong></p><p></p><p><img src="images/120-22.png" alt="images/120-22.png" /></p><p></p><p><strong>Podemos executar </strong><strong><span style="color:#ff7800;">chown</span></strong><strong> como </strong><strong><span style="color:#ff7800;">root</span></strong><strong>.  Alteramos o proprietario de </strong><strong><span style="color:#ff7800;">/etc/passwd</span></strong><strong> :</strong></p><p></p><p><strong>Temos o binário </strong><em><strong>chown</strong></em><strong>  como root para que você possa alterar o proprietário de determinados  arquivos para remover a senha do usuário root, vamos ver como fazer:</strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong>executaremos </strong><em><strong>chown</strong></em><strong> da seguinte maneira:</strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><strong><span style="color:#ff7800;">sudo -u root chown gladys /etc/passwd</span></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong>sudo -u root: executará o comando como usuário root, pois é o único que tem permissão como visto na imagem.</strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong>chown gladys /etc/passwd: estamos indicando que /etc/passwd passa a ser propriedade de gladys.</strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong>Para ver se funcionou, executaremos </strong><strong><span style="color:#ff7800;">ls -l /etc/passwd</span></strong><strong> e nosso usuário deverá aparecer como proprietário.</strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><img src="images/120-23.png" alt="images/120-23.png" /></p><p></p><p>Nesta máquina não temos nano, <span style="color:#ff7800;">vi </span>ou <span style="color:#ff7800;">vim</span> para editar arquivos então faremos e vamos ver como fazer:</p><p></p><p>comando: <span style="color:#ff7800;">sed -i &#39;s/root:x:/root::/g&#39; /etc/passwd</span> </p><p></p><p><img src="images/120-24.png" alt="images/120-24.png" /></p><p></p><p><img src="images/120-25.png" alt="images/120-25.png" /></p><p></p><p>mas nos dirá que a permissão foi negada, então teremos que copiar <em>passwd</em> para <em>tmp</em> , </p><p>modificá-lo com o parâmetro <em>-i</em> e verificar se a senha do usuário root foi removida.</p><p></p><p><img src="images/120-26.png" alt="images/120-26.png" /></p><p></p><p><span style="color:#ff7800;">sed -i &#39;s/root:x:/root::/g&#39; /tmp/passwd</span></p><p></p><p><img src="images/120-27.png" alt="images/120-27.png" /></p><p><img src="images/120-28.png" alt="images/120-28.png" /></p><p></p><p>agora executamos cat de passwd e o x do usu├írio root deve ser eliminado</p><p></p><p><img src="images/120-29.png" alt="images/120-29.png" /></p><p></p><p>Agora devemos copiar este arquivo para <span style="color:#ff7800;">/etc/passwd</span> faremos isso com o seguinte comando:</p><p></p><p><img src="images/120-30.png" alt="images/120-30.png" /></p><p></p><p><img src="images/120-31.png" alt="images/120-31.png" /></p><p></p><p>Vemos que o x foi removido corretamente, entao vamos tentar mudar para root com o seguinte comando:</p><p><span style="color:#ff7800;">su</span> ou su <span style="color:#ff7800;">root</span></p><p></p><p><img src="images/120-32.png" alt="images/120-32.png" /></p><p></p><p>somos <span style="color:#ff7800;">root</span></p><p></p><p><span style="color:#ff0000;text-decoration:line-through;">bobmarley</span></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p></div>
</body>
</html>
