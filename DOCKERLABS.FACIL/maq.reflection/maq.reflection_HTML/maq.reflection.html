<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>maq.reflection</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><p></p><p><strong><span style="color:#ff0000;">MÁQUINA REFLECTION</span></strong></p><p></p><p><img src="images/238-1.png" alt="images/238-1.png" /></p><p></p><p><strong>Para utilizar esta máquina devemos primeiro baixar os arquivos e assim implantá-la com Docker.</strong><strong></strong></p><p><strong>  </strong><strong></strong></p><p><strong>Baixamos o arquivo da página </strong><strong><a href="https://dockerlabs.es/">https://dockerlabs.es/</a></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong>Para implantar o laboratório executamos da seguinte forma, para que também possamos ver que ele nos diz a direção que teremos, bem como o que fazer quando terminarmos.</strong></p><p></p><p><img src="images/238-2.png" alt="images/238-2.png" /></p><p></p><p><strong><span style="color:#ff0000;">COLETA DE INFORMAÇÕES </span></strong></p><p></p><p><strong><span style="color:#ff7800;">nmap 172.17.0.2 -A -sS -sC -sV -Pn -p- -T5 </span></strong></p><p></p><p><strong>Temos duas portas aberta:</strong></p><p></p><p><strong><span style="color:#ff7800;">22/tcp open  ssh     OpenSSH 9.2p1 Debian</span></strong><strong><span style="color:#ff7800;"></span></strong></p><p><strong><span style="color:#ff7800;">80/tcp open  http    Apache httpd 2.4.62 ((Debian))</span></strong></p><p></p><p><img src="images/238-3.png" alt="images/238-3.png" /></p><p></p><p><strong>Vamos fazer um </strong><strong><span style="color:#ff7800;">fuzzing </span></strong><strong>para ver se tem pastas ocultas, com a ferramenta </strong><strong><span style="color:#ff7800;">gobuster</span></strong><strong>.</strong></p><p></p><p><strong>gobuster dir -u </strong><strong><a href="http://172.17.0.2">http://172.17.0.2</a></strong><strong> -w /usr/share/seclists/Discovery/Web-Content/big.txt -x .txt,.html,.php,.py</strong></p><p></p><p><img src="images/238-4.png" alt="images/238-4.png" /></p><p></p><p><strong>Vamos explorar a porta 80: </strong><strong><a href="http://172.17.0.2/">http://172.17.0.2/</a></strong></p><p></p><p><img src="images/238-5.png" alt="images/238-5.png" /></p><p></p><p><strong>Vamos o código fonte, e temos um usuário e senha: view-source:</strong><strong><a href="http://172.17.0.2/">http://172.17.0.2/</a></strong></p><p></p><p><strong>Usuario: </strong><strong><span style="color:#ff7800;">balu</span></strong><strong></strong></p><p><strong>Password: </strong><strong><span style="color:#ff7800;">balulero</span></strong></p><p></p><p><img src="images/238-6.png" alt="images/238-6.png" /></p><p></p><p><strong>Veja que conseguimos fazer o login no </strong><strong><span style="color:#ff7800;">ssh</span></strong><strong> com o usuário </strong><strong><span style="color:#ff7800;">balu</span></strong><strong>.</strong></p><p></p><p><strong><span style="color:#ff7800;">ssh balu@172.17.0.2 </span></strong></p><p></p><p><img src="images/238-7.png" alt="images/238-7.png" /></p><p></p><p><strong>Vamos procurar por privilégios:</strong></p><p></p><p><strong><span style="color:#ff7800;">sudo -l</span></strong></p><p></p><p><strong>não temos permissão para executar o comando.</strong></p><p></p><p><img src="images/238-8.png" alt="images/238-8.png" /></p><p></p><p><strong>Vamos usar o comando de </strong><strong><span style="color:#ff7800;">suid</span></strong><strong>.</strong></p><p></p><p><strong><span style="color:#ff7800;">find / -perm -4000 2&gt;/dev/null</span></strong></p><p></p><p><img src="images/238-9.png" alt="images/238-9.png" /></p><p></p><p><strong>Temos o arquivo env, então vamos para o site: </strong><strong><a href="https://gtfobins.github.io/gtfobins/env/#sudo">https://gtfobins.github.io/gtfobins/env/#sudo</a></strong></p><p></p><p><img src="images/238-10.png" alt="images/238-10.png" /></p><p></p><p><strong>Com o comando abaixo conseguimos o privilégio de root.</strong></p><p></p><p><strong><span style="color:#ff7800;">/usr/bin/env /bin/bash -p</span></strong></p><p></p><p><img src="images/238-11.png" alt="images/238-11.png" /></p><p></p><p><strong><span style="color:#ff7800;">somos root</span></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><strong><span style="color:#ff0000;text-decoration:line-through;">R10</span></strong></p><p></p><p><strong>★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★</strong></p><p></p><p><strong><span style="color:#ff0000;">UMA OUTRA OPÇÃO DE SER ROOT</span></strong></p><p></p><p><strong>Na pasta raíz do sistema temos um arquivo </strong><strong><span style="color:#ff7800;">secret.bak</span></strong><strong>, e nele temos um usuário e senha.</strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong>usuário: </strong><strong><span style="color:#ff7800;">balulito</span></strong><strong></strong></p><p><strong>senha: </strong><strong><span style="color:#ff7800;">balulerochingon</span></strong></p><p></p><p><img src="images/238-12.png" alt="images/238-12.png" /></p><p></p><p><strong>Vamos prosseguir e entrar nesse usuário e procurar por privilégios de root.</strong></p><p></p><p><strong>Veja que conseguimos entrar no usuário </strong><strong><span style="color:#ff7800;">balulito</span></strong><strong>, procurar por privilégios com </strong><strong><span style="color:#ff7800;">suid,</span></strong><strong> com o comando a abaixo, e logo em seguida conseguimos acessar o usuário </strong><strong><span style="color:#ff7800;">root </span></strong><strong>novamente com </strong><strong><span style="color:#ff7800;">env</span></strong><strong>. </strong> <strong>site:</strong><strong><a href="https://gtfobins.github.io/gtfobins/env/#sudo">https://gtfobins.github.io/gtfobins/env/#sudo</a></strong></p><p></p><p><strong><span style="color:#ff7800;">find / -perm -4000 2&gt;/dev/null</span></strong></p><p></p><p><img src="images/238-13.png" alt="images/238-13.png" /></p><p></p><p> <strong>★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★</strong></p><p> </p><p><strong> </strong><strong><span style="color:#ff0000;">TERCEIRA OPÇÃO PARA SER ROOT.</span></strong></p><p> </p><p><strong> Com o comando </strong><strong><span style="color:#ff7800;">sudo -l</span></strong><strong>:</strong></p><p> </p><p><strong> Você tem permissão para rodar o comando </strong><strong><span style="color:#ff7800;">/bin/cp </span></strong><strong>como root sem precisar fornecer senha. Isso pode ser usado para copiar arquivos ou substituir arquivos do sistema, ou que pode ser útil para escalar privilégios.</strong><strong></strong></p><p><strong>Aqui está uma abordagem que você pode tentar escalar privilégios ou modificar arquivos críticos como </strong><strong><span style="color:#ff7800;">/etc/passwd</span></strong><strong> ou </strong><strong><span style="color:#ff7800;"> /etc/shadow</span></strong><strong> :</strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><strong><h3>Passo 1</h3></strong><strong><h3>: Copiar arquivos críticos</h3></strong><strong></strong></p><p><strong>Primeiro, copie os arquivos que você deseja editar para um local acessível, como o diretório </strong><strong><span style="color:#ff7800;">/tmp </span></strong><strong>.</strong></p><p></p><p><strong>Vamos copiar o arquivo </strong><strong><span style="color:#ff7800;">/etc/passwd</span></strong><strong> para a pasta </strong><strong><span style="color:#ff7800;">/tmp</span></strong><strong>.</strong></p><p></p><p><img src="images/238-14.png" alt="images/238-14.png" /></p><p></p><p><strong><span style="color:#ff0000;">Passo 2: </span></strong></p><p><strong>Agora vamos copiar o arquivo e editar com </strong><strong><span style="color:#ff7800;">nano</span></strong><strong>.</strong></p><p></p><p><img src="images/238-15.png" alt="images/238-15.png" /></p><p></p><p></p><p><strong><h3>Passo 3</h3></strong><strong><h3>: Substituir os arquivos originais</h3></strong><strong></strong></p><p><strong>Depois de editar os arquivos, substitua os arquivos originais com o comando </strong><strong><span style="color:#ff7800;">cp </span></strong><strong>(já que você pode usar esse comando como </strong><strong><span style="color:#ff7800;">root </span></strong><strong>sem precisar de senha).</strong></p><p></p><p><strong><span style="color:#ff7800;">sudo cp /tmp/passwd /etc/passwd</span></strong></p><p></p><p><img src="images/238-16.png" alt="images/238-16.png" /></p><p></p><p><strong><h3>Passo 4</h3></strong><strong><h3>: Testar o acesso</h3></strong><strong></strong></p><p><strong>Agora, você pode tentar fazer login como </strong><strong><span style="color:#ff7800;">root </span></strong><strong>ou outro usuário que você tenha configurado.</strong></p><p></p><p><strong>Agora com o comando </strong><strong><span style="color:#ff7800;">su</span></strong><strong>, vamos ser </strong><strong><span style="color:#ff7800;">root</span></strong><strong>.</strong></p><p></p><p><img src="images/238-17.png" alt="images/238-17.png" /></p><p></p><p><strong><span style="color:#ff7800;">Somos root</span></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><strong><span style="color:#ff0000;text-decoration:line-through;">R10</span></strong><strong></strong></p><p><strong></strong></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p> </p><p> </p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p></div>
</body>
</html>
