<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>maq.nodeclimb</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>maq.nodeclimb</h1><br/><p></p><p><strong><span style="color:#ff0000;">MÁQUINA NODECLIMB</span></strong></p><p></p><p><img src="images/234-1.png" alt="images/234-1.png" /></p><p></p><p><strong>Para utilizar esta máquina devemos primeiro baixar os arquivos e assim implantá-la com Docker.</strong><strong></strong></p><p><strong>  </strong><strong></strong></p><p><strong>Baixamos o arquivo da página </strong><strong><a href="https://dockerlabs.es/">https://dockerlabs.es/</a></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong>Para implantar o laboratório executamos da seguinte forma, para que também possamos ver que ele nos diz a direção que teremos, bem como o que fazer quando terminarmos.</strong></p><p></p><p><img src="images/234-2.png" alt="images/234-2.png" /></p><p></p><p><strong><span style="color:#ff0000;">COLETA DE INFORMAÇÕES </span></strong></p><p></p><p><strong><span style="color:#ff7800;">nmap 172.17.0.2 -A -sS -sC -sV -Pn -p- -T5 </span></strong></p><p></p><p><strong>Temos duas portas aberta:</strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><strong><span style="color:#ff7800;">21/tcp open  ftp     vsftpd 3.0.3</span></strong><strong><span style="color:#ff7800;"></span></strong></p><p><strong><span style="color:#ff7800;">22/tcp open  ssh     OpenSSH 9.2p1 Debian</span></strong></p><p></p><p><img src="images/234-3.png" alt="images/234-3.png" /></p><p></p><p><strong>Vamos explorar a porta 21, podemos fazer o login sem senha, vamos baixar o arquivo que esta nela para nossa máquina atacante.</strong></p><p></p><p><strong><span style="color:#ff7800;">get secretitopicaron.zip</span></strong></p><p></p><p><img src="images/234-4.png" alt="images/234-4.png" /></p><p></p><p><strong><h3>Tentamos descompactar o arquivo, mas percebemos que não é possível, pois possui senha.</h3></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><strong><span style="color:#ff7800;">unzip secretitopicaron.zip</span></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><img src="images/234-5.png" alt="images/234-5.png" /></p><p></p><p>O que podemos fazer para obter a senha, devemos primeiro fazer o hash do arquivo com a extensão <code>zip2john</code>.</p><p></p><p><span style="color:#ff7800;">zip2john secretitopicaron.zip &gt; hash.txt</span></p><p></p><p><img src="images/234-6.png" alt="images/234-6.png" /></p><p></p><p>Depois usamos o John para obter a senha e se tudo correr bem como nesta ocasião podemos ver que a senha é <span style="color:#ff7800;">password1</span>.</p><p></p><p><span style="color:#ff7800;">john --wordlist=/usr/share/wordlists/rockyou.txt hash.txt</span></p><p></p><p><img src="images/234-7.png" alt="images/234-7.png" /></p><p></p><p><h3>Descompactamos o arquivo e podemos ver que o arquivo possui um TXT que possui um nome de usuário e uma senha.</h3></p><p></p><p><span style="color:#ff7800;">unzip -P password1 secretitopicaron.zip</span></p><p></p><p><img src="images/234-8.png" alt="images/234-8.png" /></p><p></p><p><strong><span style="color:#ff7800;">cat password.txt</span></strong></p><p></p><p><strong>mario:</strong><strong><span style="color:#ff7800;">laKontraseñAmasmalotaHdelbarrioH</span></strong><span style="color:#ff7800;"></span></p><p><span style="color:#ff7800;"></span></p><p><img src="images/234-9.png" alt="images/234-9.png" /></p><p></p><p><strong><h3>Usamos essas credenciais para conectar via </h3></strong><strong><h3>SSH </h3></strong><strong><h3>e podemos ver que conseguimos acessar.</h3></strong></p><p></p><p><img src="images/234-10.png" alt="images/234-10.png" /></p><p></p><p><strong><h3>Assim que entrarmos, podemos ver que existe um arquivo </h3></strong><strong><h3>script.js</h3></strong><strong><h3> do qual somos proprietários, mas não contém nada.</h3></strong></p><p></p><p><img src="images/234-11.png" alt="images/234-11.png" /></p><p></p><p><strong>Vamos buscar privilégios com </strong><strong><span style="color:#ff7800;">sudo -l </span></strong><strong>.</strong></p><p></p><p><strong>O comando </strong><strong><code>sudo -l</code></strong><strong> mostrou que o usuário </strong><strong><code>mario</code></strong><strong> tem permissão para executar o script </strong><strong><code>script.js</code></strong><strong> com o Node.js sem fornecer uma senha. Essa configuração pode ser explorada para ganhar privilégios elevados ou executar comandos indesejados.</strong></p><p></p><p><img src="images/234-12.png" alt="images/234-12.png" /></p><p></p><p><strong>Como observamos que um arquivo JS precisa ser executado, usaremos um da página </strong><strong><a href="https://www.revshells.com/">revshells</a></strong><strong> e inseriremos o conteúdo no arquivo script.js.</strong></p><p></p><p><img src="images/234-13.png" alt="images/234-13.png" /></p><p></p><p><strong>Vamos copiar esse reverse shell e colar no </strong><strong><span style="color:#ff7800;">script.js</span></strong><strong> </strong>.</p><p></p><p><strong><span style="color:#ff7800;">nano script.js</span></strong></p><p></p><p><img src="images/234-14.png" alt="images/234-14.png" /></p><p></p><p><strong>Agora é só deixar o </strong><strong><span style="color:#ff7800;">netcat</span></strong><strong> na esculta, antes de dar o comando.</strong></p><p></p><p><img src="images/234-15.png" alt="images/234-15.png" /></p><p></p><p><strong><span style="color:#ff7800;">sudo /usr/bin/node /home/mario/script.js</span></strong></p><p></p><p><img src="images/234-16.png" alt="images/234-16.png" /></p><p></p><p><strong><span style="color:#ff7800;">Somos root</span></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><strong><span style="color:#ff0000;text-decoration:line-through;">R10</span></strong></p></div>
</body>
</html>
