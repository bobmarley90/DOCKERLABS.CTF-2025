<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>maq.escolares</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>maq.escolares</h1><br/><p></p><p><strong><span style="color:#ff0000;">MÁQUINA ESCOLARES</span></strong></p><p></p><p><img src="images/135-1.png" alt="images/135-1.png" /></p><p></p><p><strong>Para utilizar esta máquina devemos primeiro baixar os arquivos e assim implantá-la com Docker.</strong><strong></strong></p><p><strong>  </strong><strong></strong></p><p><strong>Baixamos o arquivo da página </strong><strong><a href="https://dockerlabs.es/">https://dockerlabs.es/</a></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong>Para implantar o laboratório executamos da seguinte forma, para que também possamos ver que ele nos diz a direção que teremos, bem como o que fazer quando terminarmos.</strong><strong></strong></p><p><strong></strong></p><p><img src="images/135-2.png" alt="images/135-2.png" /></p><p></p><p><strong><span style="color:#ff0000;">COLETA DE INFORMAÇÕES </span></strong></p><p></p><p><span style="color:#ff7800;">nmap 172.17.0.2 -A -sS -sV -sC  --open -p- -T5 -n -Pn          </span>                      </p><p>                                                        </p><p><strong>Verificando as portas podemos ver que temos duas postas abertas  a 22 e a 80.    </strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><img src="images/135-3.png" alt="images/135-3.png" />                       </p><p><strong><h3>Neste caso, focaremos na porta 80 executando um Apache. Acessaremos a página web hospedada nesta máquina através de um navegador e veremos o seguinte.</h3></strong></p><p></p><p><img src="images/135-4.png" alt="images/135-4.png" /></p><p></p><p><strong>ao explorar a página quando clicamos em profesores. Notamos que nele tem  um ( </strong><strong><span style="color:#ff7800;">admin wordpress</span></strong><strong> )</strong>.</p><p></p><p><img src="images/135-5.png" alt="images/135-5.png" /></p><p></p><p><img src="images/135-6.png" alt="images/135-6.png" /></p><p></p><p><strong>Ao aplicar técnicas de fuzzing na direção , </strong><strong><a href="http://172.17.0.2">http://172.17.0.2</a></strong><strong> descobrimos diversas rotas, inclusive </strong><strong><span style="color:#ff7800;">wordpress</span></strong><strong>. Ao acessar esta rota, encontramos uma página que parece estar configurada com WordPress.</strong></p><p></p><p><strong><span style="color:#ff7800;">gobuster dir -u </span></strong><strong><a href="http://172.17.0.2">http://172.17.0.2</a></strong><strong><span style="color:#ff7800;"> -w /usr/share/wordlists/dirb/common.txt -x txt,php,html</span></strong></p><p></p><p></p><p></p><p><img src="images/135-7.png" alt="images/135-7.png" /></p><p></p><p><strong><h3>Ao usar a ferramenta wpscan com o comando </h3></strong><strong><code><h3>wpscan --url http://172.17.0.2/wordpress --enumerate u,vp</h3></code></strong><strong><h3>, podemos verificar a existência de plugins vulneráveis ​​e listar os usuários existentes.</h3></strong><strong></strong></p><p><strong></strong><strong><h3>No processo, encontramos um usuário chamado</h3></strong><strong><h3> luisillo</h3></strong><strong><h3>, que corresponde a um dos professores que vimos anteriormente.</h3></strong></p><p></p><p><img src="images/135-8.png" alt="images/135-8.png" /></p><p></p><p><h3>A</h3><strong><h3>gora podemos tentar fazer ataques de força bruta usando ( _NÃO execute os seguintes comandos_ ) </h3></strong><strong><code><h3>wpscan --url http://172.17.0.2/wordpress -U luisillo -P /usr/share/wordlists/rockyou.txt</h3></code></strong><strong><h3>, mas podemos não ter sucesso já que no dicionário </h3></strong><strong><code><h3>rockyou.txt</h3></code></strong><strong><h3>não encontraremos uma chave para fazer login...</h3></strong><strong></strong></p><p><strong></strong><strong><h3>Em situações como essa, podemos usar uma ferramenta chamada </h3></strong><strong><code><h3>cupp</h3></code></strong><strong><h3>para gerar dicionários de senhas personalizados com base nas informações que fornecemos.</h3></strong><strong></strong></p><p><strong></strong><strong><h3>Para usar o cupp, executamos o comando </h3></strong><strong><code><h3>cupp -i</h3></code></strong><strong><h3>, que inicia um formulário interativo. A ferramenta nos fará uma série de perguntas e, com base em nossas respostas, gerará um dicionário de senhas.</h3></strong><strong></strong></p><p><strong></strong><strong><h3>Neste caso, o cupp gerou um dicionário chamado </h3></strong><strong><code><h3>luis.txt</h3></code></strong><strong><h3>.</h3></strong></p><p></p><p><img src="images/135-9.png" alt="images/135-9.png" /></p><p></p><p><strong>Agora usaremos¬†</strong><strong><code>wpscan --url http://172.17.0.2/wordpress -U luisillo -P luis.txt</code></strong><strong>mas passando o caminho do dicion√°rio de dados que acabamos de gerar usando</strong><strong><code>cupp</code></strong></p><p></p><p><img src="images/135-10.png" alt="images/135-10.png" /></p><p></p><p><img src="images/135-11.png" alt="images/135-11.png" /></p><p></p><p><img src="images/135-12.png" alt="images/135-12.png" /></p><p></p><p><strong>UMA OUTRA OPÇAO DE FORÇA BRUTA É O HYDRA.</strong></p><p></p><p><strong><span style="color:#ff7800;">hydra -l luisillo -P luis.txt  172.17.0.2 http-post-form &quot;/wordpress/wp-login.php:log=^USER^&amp;pwd=^PASS^&amp;wp-submit=Log In&amp;testcookie=1:S=Location&quot; -t 64</span></strong></p><p></p><p><img src="images/135-13.png" alt="images/135-13.png" /></p><p></p><p><img src="images/135-14.png" alt="images/135-14.png" /></p><p><img src="images/135-15.png" alt="images/135-15.png" /></p><p></p><p><strong><h3>A seguir, procedemos ao login usando as credenciais obtidas. Uma vez dentro do painel de administração do WordPress, nosso objetivo é encontrar uma forma de acessar o servidor.</h3></strong><strong></strong></p><p><strong></strong><strong><h3>Uma estratégia para conseguir isso é aproveitar as vantagens de um plugin instalado chamado </h3></strong><strong><code><h3>WP File Manager</h3></code></strong><strong><h3>. Este plugin permite gerenciar arquivos do servidor diretamente do painel de administração, o que pode facilitar o acesso ao sistema de arquivos e, potencialmente, a outras áreas do servidor.</h3></strong></p><p></p><p><img src="images/135-16.png" alt="images/135-16.png" /></p><p></p><p><strong><span style="color:#ff0000;">ENTRAMOS NO WORDPRESS</span></strong></p><p></p><p><img src="images/135-17.png" alt="images/135-17.png" /></p><p></p><p><strong>podemos ver que temos </strong><strong><code>WP File Manager</code></strong></p><p></p><p><img src="images/135-18.png" alt="images/135-18.png" /></p><p></p><p><strong>Abrimos a aba e podemos ver o que temos nos </strong><strong><code>themes</code></strong><strong>arquivos </strong><strong><code>twenty</code></strong><strong>.</strong></p><p></p><p><img src="images/135-19.png" alt="images/135-19.png" /></p><p></p><p><strong><h3>Carregamos um arquivo de teste test.php e podemos ver que é possível executar um </h3></strong><strong><h3>PHP</h3></strong><strong><h3>.</h3></strong></p><p></p><p><img src="images/135-20.png" alt="images/135-20.png" /></p><p></p><p><strong><h3>Se formos ao endereço onde está localizado nosso arquivo, veremos que ele foi executado.</h3></strong></p><p><a href="http://escolares.dl/wordpress/wp-content/themes/twentytwentytwo/TEST.php">http://escolares.dl/wordpress/wp-content/themes/twentytwentytwo/TEST.php</a></p><p></p><p><img src="images/135-21.png" alt="images/135-21.png" /></p><p></p><p><strong>Agora que sabemos que podemos fazer upload de arquivos, faremos upload de um reverse shell. Como aquele que podemos encontrar no </strong><strong><a href="https://www.revshells.com/">https://www.revshells.com/</a></strong><strong> antes de enviar o arquivo, primeiro iniciamos nosso ouvinte com a porta que atribuímos em nosso reverse shell.  </strong></p><p></p><p><img src="images/135-22.png" alt="images/135-22.png" /></p><p></p><p>Uma vez carregado, <code>reverse shell</code> inserimos o endereço web e podemos ver que já temos acesso.</p><p></p><p><a href="http://escolares.dl/wordpress/wp-content/themes/twentytwentytwo/shell10.php">http://escolares.dl/wordpress/wp-content/themes/twentytwentytwo/shell10.php</a></p><p><img src="images/135-23.png" alt="images/135-23.png" /></p><p></p><p><strong>deixe o netcat na esculta:</strong>  <strong><span style="color:#ff7800;">nc -lvnp 1999 </span></strong></p><p></p><p><strong>temos a reverse shell no terminal da máquina atacante</strong></p><p></p><p><img src="images/135-24.png" alt="images/135-24.png" /></p><p></p><p><strong><h3>Assim que eu fizer isso. Já temos maior mobilidade. Podemos ver que somos </h3></strong><strong><h3>www-data</h3></strong><strong><h3> então não devemos ter muitas permissões então iremos para home para ver se podemos acessar um diretório sem precisar de senha e podemos ver em home que além dos usuários temos um arquivo chamado</h3></strong><strong><h3></h3></strong></p><p><strong><h3></h3></strong><strong><h3>secret.txt</h3></strong><strong><h3> que contém a senha de </h3></strong><strong><h3>Luisillo</h3></strong><strong><h3>.</h3></strong></p><p></p><p><img src="images/135-25.png" alt="images/135-25.png" /></p><p></p><p><strong><span style="color:#ff0000;">usuário</span></strong><strong>: luisillo</strong><strong></strong></p><p><strong></strong><strong><span style="color:#ff0000;">senha</span></strong><strong>: luisillopasswordsecret</strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><strong><span style="color:#ff7800;">ssh luisillo@172.17.0.2 </span></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><img src="images/135-26.png" alt="images/135-26.png" /></p><p></p><p>Como já somos usuários. Primeiro vamos até sua pasta e listamos, mas não vemos nada, fazendo um <code>sudo -l</code>podemos ver que temos a capacidade de elevar privilégios através do binário <code>awk</code>.</p><p></p><p><img src="images/135-27.png" alt="images/135-27.png" /></p><p></p><p>Vamos para a página <a href="https://gtfobins.github.io/gtfobins/awk/#sudo">https://gtfobins.github.io/gtfobins/awk/#sudo</a> e observamos o comando para poder elevar privilégios abusando deste binário.</p><p></p><p><img src="images/135-28.png" alt="images/135-28.png" /></p><p></p><p><img src="images/135-29.png" alt="images/135-29.png" /></p><p></p><p><span style="color:#ff7800;">somos root</span></p><p></p><p><span style="color:#ff0000;text-decoration:line-through;">bobmarley</span></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p></div>
</body>
</html>
