<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>maq.consolelog</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>maq.consolelog</h1><br/><p></p><p><strong><span style="color:#ff0000;">MÁQUINA CONSOLELOG</span></strong></p><p></p><p><img src="images/123-1.png" alt="images/123-1.png" /></p><p></p><p><strong>Para utilizar esta máquina devemos primeiro baixar os arquivos e assim implantá-la com Docker.</strong><strong></strong></p><p><strong>  </strong><strong></strong></p><p><strong>Baixamos o arquivo da página </strong><strong><a href="https://dockerlabs.es/">https://dockerlabs.es/</a></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong>Para implantar o laboratório executamos da seguinte forma, para que também possamos ver que ele nos diz a direção que teremos, bem como o que fazer quando terminarmos.</strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><img src="images/123-2.png" alt="images/123-2.png" /></p><p></p><p><span style="color:#ff0000;">COLETA DE INFORMAÇÕES </span></p><p></p><p><span style="color:#ff7800;">nmap 172.17.0.2  -A -sS -sV -sC  --open -p- -T5 -n -Pn      </span></p><p></p><p><img src="images/123-3.png" alt="images/123-3.png" /></p><p></p><p><strong>Observamos  que a </strong><strong><span style="color:#ff7800;">porta 80</span></strong><strong> está usando o protocolo HTTP com o serviço </strong><strong><span style="color:#ff7800;">Apache versão  2.4.61</span></strong><strong>. </strong><strong></strong></p><p><strong>A </strong><strong><span style="color:#ff7800;">porta 3000</span></strong><strong> também opera sob o protocolo HTTP e executa um  serviço </strong><strong><span style="color:#ff7800;">Node.js</span></strong><strong> com Express. </strong><strong></strong></p><p><strong>Por outro lado, a </strong><strong><span style="color:#ff7800;">porta 5000</span></strong><strong> está  configurada para o protocolo </strong><strong><span style="color:#ff7800;">SSH</span></strong><strong>.</strong><strong></strong></p><p><strong>Em primeiro lugar, vamos nos concentrar na </strong><strong><span style="color:#ff7800;">porta 80</span></strong><strong>. Ao acessar esta porta a partir de um navegador, veremos o seguinte:</strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><img src="images/123-4.png" alt="images/123-4.png" /></p><p></p><p>Na página, vemos um título que diz <span style="color:#ff7800;">“Bem-vindo ao meu site” </span>e um botão que diz <span style="color:#ff7800;">“Botão em fase beta”.</span></p><p>Ao  clicar neste botão e verificar o console do navegador, encontramos a  seguinte mensagem: ***Para opçãoVemos um título que diz <span style="color:#ff7800;">&quot;Bem-vindo ao  meu site&quot; </span>e um botão que diz <span style="color:#ff7800;">&quot;Botão em fase beta&quot;</span>...</p><p>Se clicarmos nesse botão e vermos o console do navegador, veremos uma mensagem que diz <em>Para </em><em><span style="color:#ff7800;">opções de depuração</span></em><em>, o token /recurso/ é tokentraviesito</em>  , se aplicarmos o Fuzzing à web encontraremos algumas rotas  interessantes como estas.es depuração, o token de /recurso/ é  tokentraviesito***.</p><p>Se aplicarmos técnicas de <span style="color:#ff7800;">Fuzzing </span>no site, descobriremos alguns caminhos interessantes, como os seguintes:</p><p></p><p><img src="images/123-5.png" alt="images/123-5.png" /></p><p></p><p>Se entrarmos nesta rota veremos o seguinte:</p><p></p><p><img src="images/123-6.png" alt="images/123-6.png" /></p><p></p><p>Acessando o arquivo server.js, podemos ver o codigo fonte do referido arquivo.</p><p></p><p><img src="images/123-7.png" alt="images/123-7.png" /></p><p></p><p>outra maneira de ver a senha atraves do terminal é com comando:</p><p></p><p><span style="color:#ff7800;">curl -X POST</span> <a href="http://172.17.0.2:3000/recurso/">http://172.17.0.2:3000/recurso/</a> <span style="color:#ff7800;">-H &quot;Content-Type: application/json&quot; -d &#39;{&quot;token&quot;:&quot;tokentraviesito&quot;}&#39;</span></p><p></p><p><img src="images/123-8.png" alt="images/123-8.png" /></p><p></p><p>O  arquivo que estamos vendo em resumo é um servidor montado com Express e  possui um endpoint definido que permite requisições utilizando o método  <span style="color:#ff7800;">POST</span> para uma rota chamada <code>/recurso/</code>e basicamente se enviarmos um campo chamado na <code>body</code> requisição <code>token</code>e colocarmos o valor do <code>tokentraviesito</code> servidor iremos responder com uma mensagem que diz <code>lapassworddebackupmaschingonadetodas</code>...  Notamos que existe uma variável chamada porta, que está configurada com  o valor <span style="color:#ff7800;">3000</span>, indicando a porta na qual o servidor está escutando. É  por isso que a <span style="color:#ff7800;">porta 3000 </span>apareceu aberta durante a nossa varredura.</p><p>Agora podemos enviar uma requisição <span style="color:#ff7800;">POST</span> com o <code>token</code>campo y no valor send <code>tokentraviesito</code>para  receber a mensagem, mas como já estamos vendo diretamente o que o  servidor irá nos responder, não vejo necessidade de segui-lo... Apenas  copie a resposta que é <code>lapassworddebackupmaschingonadetodas</code>,  lembre-se que a <span style="color:#ff7800;">porta 5000 roda SSH</span>, agora podemos tentar fazer ataques  de força bruta com <span style="color:#ff7800;">Hydra</span> usando a referida senha possível e uma lista  de possíveis usuários para ver se conseguimos obter acesso...</p><p>E vemos que conseguimos encontrar credenciais válidas.</p><p></p><p><img src="images/123-9.png" alt="images/123-9.png" /></p><p></p><p>explicação do comando <span style="color:#ff7800;">hydra </span></p><p></p><p><img src="images/123-10.png" alt="images/123-10.png" /></p><p></p><p><img src="images/123-11.png" alt="images/123-11.png" /></p><p></p><p><h2>Escalação de privilégios</h2></p><p></p><p>Ao executar o comando <span style="color:#ff7800;">sudo -l</span>, vemos que podemos executar o binário <span style="color:#ff7800;">/usr/bin/nano </span> como qualquer usuário sem precisar fornecer uma senha.</p><p></p><p><img src="images/123-12.png" alt="images/123-12.png" /></p><p></p><p><span style="color:#ff0000;">EXEMPLO 1 PARA SER ROOT</span>:  <span style="color:#ff7800;">openssl passwd</span></p><p></p><p>Iremos gerar um hash usando <span style="color:#ff7800;">openssl passwd </span>a senha de nossa escolha; neste caso, usarei a senha <span style="color:#ff7800;">Deus</span>.</p><p>Assim que o hash for gerado, iremos copilo para uso posterior.</p><p></p><p><img src="images/123-13.png" alt="images/123-13.png" /></p><p></p><p>A seguir, abriremos o arquivo <span style="color:#ff7800;">/etc/passwd </span>usando o comando <span style="color:#ff7800;">sudo /usr/bin/nano /etc/passwd </span>. Dentro do arquivo, substituiremos o caractere x na entrada correspondente pelo hash que geramos anteriormente.</p><p></p><p></p><p></p><p>O arquivo<span style="color:#ff7800;"> /etc/passwd </span>deve ficar assim após a substituição. </p><p>Em seguida, salvamos as alterações e saímos do editor.</p><p></p><p><img src="images/123-14.png" alt="images/123-14.png" /></p><p></p><p><img src="images/123-15.png" alt="images/123-15.png" /></p><p></p><p>Agora só precisamos executar o comando<span style="color:#ff7800;"> su root </span>e digitar a senha que usamos para gerar o hash, no meu caso pwned. Isso nos permitirá nos tornar o usuário <span style="color:#ff7800;">root</span>.</p><p></p><p><img src="images/123-16.png" alt="images/123-16.png" /></p><p></p><p><span style="color:#ff7800;">somos root</span></p><p></p><p>*************************************************************************************************************************</p><p></p><p><span style="color:#ff0000;">EXEMPLO 2</span></p><p></p><p><img src="images/123-17.png" alt="images/123-17.png" /></p><p></p><p><img src="images/123-18.png" alt="images/123-18.png" /></p><p></p><p><img src="images/123-19.png" alt="images/123-19.png" /></p><p></p><p><img src="images/123-20.png" alt="images/123-20.png" /></p><p></p><p><img src="images/123-21.png" alt="images/123-21.png" /></p><p></p><p><img src="images/123-22.png" alt="images/123-22.png" /></p><p></p><p><span style="color:#ff7800;">somos root</span></p><p></p><p><span style="color:#ff0000;text-decoration:line-through;">bobmarley</span><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong></p><p></p><p></p><p></p><p></p><p></p><p></p></div>
</body>
</html>
